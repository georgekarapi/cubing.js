import{b as P}from"./chunk-QIOL4UIE.js";var u=class{#e=0;#t=0;queue(e){return new Promise(async(t,r)=>{try{let s=++this.#e,i=await e;s>this.#t&&(this.#t=s,t(i))}catch(s){r(s)}})}};var O=0,p=class{constructor(){this.#e=new Set;this.lastSourceGeneration=0;this.#t=new Set;this.#s=!1;this.#n=new Map}canReuse(e,t){return e===t||this.canReuseValue(e,t)}canReuseValue(e,t){return!1}debugGetChildren(){return Array.from(this.#e.values())}#e;addChild(e){this.#e.add(e)}removeChild(e){this.#e.delete(e)}markStale(e){if(e.detail.generation!==O)throw new Error("A TwistyProp was marked stale too late!");if(this.lastSourceGeneration!==e.detail.generation){this.lastSourceGeneration=e.detail.generation;for(let t of this.#e)t.markStale(e);this.#r()}}#t;addRawListener(e,t){this.#t.add(e),t?.initial&&e()}removeRawListener(e){this.#t.delete(e)}#r(){this.#s||(this.#s=!0,setTimeout(()=>this.#i(),0))}#s;#i(){if(!this.#s)throw new Error("Invalid dispatch state!");for(let e of this.#t)e();this.#s=!1}#n;addFreshListener(e){let t=new u,r=null,s=async()=>{let i=await t.queue(this.get());r!==null&&this.canReuse(r,i)||(r=i,e(i))};this.#n.set(e,s),this.addRawListener(s,{initial:!0})}removeFreshListener(e){this.removeRawListener(this.#n.get(e)),this.#n.delete(e)}},h=class extends p{#e;constructor(e){super(),this.#e=P(()=>this.getDefaultValue()),e&&(this.#e=this.deriveFromPromiseOrValue(e,this.#e))}set(e){this.#e=this.deriveFromPromiseOrValue(e,this.#e);let t={sourceProp:this,value:this.#e,generation:++O};this.markStale(new CustomEvent("stale",{detail:t}))}async get(){return this.#e}async deriveFromPromiseOrValue(e,t){return this.derive(await e,t)}},f=class extends h{derive(e){return e}},I=Symbol("no value"),w=class extends p{constructor(t,r){super();this.userVisibleErrorTracker=r;this.#e=t;for(let s of Object.values(t))s.addChild(this)}#e;#t=null;#r=null;async get(){let t=this.lastSourceGeneration;if(this.#r?.generation===t)return this.#r.output;let r={generation:t,output:this.#i(this.#s(),t,this.#t)};return this.#r=r,this.userVisibleErrorTracker?.reset(),r.output}async#s(){let t={};for(let[s,i]of Object.entries(this.#e))t[s]=i.get();let r={};for(let s in this.#e)r[s]=await t[s];return r}async#i(t,r,s=null){let i=await t,a=o=>(this.#t={inputs:i,output:Promise.resolve(o),generation:r},o);if(!s)return a(await this.derive(i));let d=s.inputs;for(let o in this.#e)if(!this.#e[o].canReuse(i[o],d[o]))return a(await this.derive(i));return s.output}},b=class{#e=[];addListener(e,t){let r=!1,s=i=>{r||t(i)};e.addFreshListener(s),this.#e.push(()=>{e.removeFreshListener(s),r=!0})}addMultiListener3(e,t){this.addMultiListener(e,t)}addMultiListener(e,t){let r=!1,s=e.length-1,i=async a=>{if(s>0){s--;return}if(r)return;let d=e.map(v=>v.get()),o=await Promise.all(d);t(o)};for(let a of e)a.addFreshListener(i);this.#e.push(()=>{for(let a of e)a.removeFreshListener(i);r=!0})}disconnect(){for(let e of this.#e)e()}};var T=class{},l;globalThis.HTMLElement?l=HTMLElement:l=T;var m=class{define(){}},c;globalThis.customElements?c=customElements:c=new m;var S=class{constructor(e){this.sourceText=e}getAsString(){return this.sourceText}},y=class extends l{constructor(t){super();this.#e=new Map;this.shadow=this.attachShadow({mode:t?.mode??"closed"}),this.contentWrapper=document.createElement("div"),this.contentWrapper.classList.add("wrapper"),this.shadow.appendChild(this.contentWrapper)}#e;addCSS(t){let r=this.#e.get(t);if(r)return r;let s=document.createElement("style");return s.textContent=t.getAsString(),this.#e.set(t,s),this.shadow.appendChild(s),s}removeCSS(t){let r=this.#e.get(t);!r||(this.shadow.removeChild(r),this.#e.delete(t))}addElement(t){return this.contentWrapper.appendChild(t)}prependElement(t){this.contentWrapper.prepend(t)}removeElement(t){return this.contentWrapper.removeChild(t)}};c.define("twisty-managed-custom-element",y);export{u as a,p as b,h as c,f as d,I as e,w as f,b as g,l as h,c as i,S as j,y as k};
//# sourceMappingURL=chunk-WKWCM3NN.js.map
