import{a as H,b as s,c as E,e as Q,f as j,g as J,h as V,i as X}from"./chunk-KYICZVAX.js";import{a as K,b as z,c as q}from"./chunk-VFJPQATA.js";import{a as _}from"./chunk-F3UND4MX.js";import{c as A,e as w}from"./chunk-S4ZNJEAB.js";import{a as b,b as W,j as $}from"./chunk-CM3DPZVF.js";import{b as l}from"./chunk-QIOL4UIE.js";import{c as D,i as M,j as P,q as x}from"./chunk-K5RKCHW3.js";var Ae=2,Ke=!0,Ee=!1;function ke(e,t){let r=[];return t.forEach(function(a){let o=new P(a);if(o.amount!==1)throw new Error("SGS cannot handle def moves with an amount other than 1 yet.");let n=e.identityTransformation();for(let i=1;n=n.applyMove(o),!n.isIdentityTransformation();i++)r.push({move:o.modified({amount:i}),transformation:n})}),r}var v=class{constructor(t,r,a){this.kpuzzle=t;this.sgs=r;this.searchMoves=ke(this.kpuzzle,a??Object.keys(this.kpuzzle.definition.moves))}async solve(t,r=Ae,a){let o=t.experimentalToTransformation();if(!o)throw new Error("distinguishable pieces are not supported in tremble solver yt");let n=null,i=1e6,d=(c,g,f)=>{if(g===0){let p=this.sgsPhaseSolve(c,i);if(!p)return;let u=f.concat(p).experimentalSimplify({cancel:{puzzleSpecificModWrap:"canonical-centered"},puzzleSpecificSimplifyOptions:{quantumMoveOrder:a}}),h=_(u);(n===null||h<i)&&(Ee&&(console.log(`New best (${h} moves): ${u.toString()}`),console.log(`Tremble moves are: ${f.toString()}`)),n=u,i=h);return}for(let p of this.searchMoves)d(c.applyTransformation(p.transformation),g-1,f.concat([p.move]))};for(let c=0;c<=r;c++)d(o,c,new x);if(n===null)throw new Error("SGS search failed.");return n}sgsPhaseSolve(t,r){let a=new D,o=t;for(let n of this.sgs.ordering){let i=n.pieceOrdering,d="",c=o.invert();for(let f=0;f<i.length;f++){let p=i[f],u=p.orbitName,h=p.permutationIdx;d+=` ${c.transformationData[u].permutation[h]} ${c.transformationData[u].orientation[h]}`}let g=n.lookup[d];if(!g)throw new Error("Missing algorithm in sgs or esgs?");if(a.experimentalPushAlg(g.alg),a.experimentalNumAlgNodes()>=r)return null;if(o=o.applyTransformation(g.transformation),Ke)for(let f=0;f<i.length;f++){let p=i[f],u=p.orbitName,h=p.permutationIdx;if(o.transformationData[u].permutation[h]!==h||o.transformationData[u].orientation[h]!==0)throw new Error("bad SGS :-(")}}return a.toAlg()}};function k(e,t){let r=e.identityTransformation();for(let a of t.ordering){let o=z(Object.values(a.lookup));r=r.applyTransformation(o.transformation)}return r.toKState()}var S=l(()=>import("./search-dynamic-sgs-side-events-U4QSVJBV.js"));var R=l(async()=>import("./twsearch-SIKUY7GP.js")),C,Y;function O(e,t){if(typeof t!="number"||!Number.isInteger(t)||t<0)throw new Error(`Invalid ${e}: ${t}`)}async function T(e,t,r){let{setArg:a,setKPuzzleDefString:o,serializeDefToTws:n,solveState:i,serializeKTransformationDataToTws:d}=await R,c=new W(e);a("--startprunedepth 5");let g="";if(r){if(r.moveSubset){if(g=r?.moveSubset?.join(","),g.includes(" "))throw new Error("A move contains a space\u203D");if(g.includes("-"))throw new Error("A move contains a dash");a(`--moves ${g}`)}let{minDepth:p,maxDepth:u}=r;typeof p<"u"?(O("minDepth",p),typeof u<"u"?O("maxDepth",u):u=1e6,a("--randomstart"),a(`--mindepth ${p}`),a(`--maxdepth ${u}`)):typeof u<"u"&&(O("maxDepth",u),a("--mindepth 0"),a(`--maxdepth ${u}`))}let f=n(c,r);if(C){if(C!==f)throw new Error("Attempted to solve two puzzles in the same worker using `twsearch`. This is not currently supported!")}else C=f,await o(f);if(typeof Y<"u"&&g!==Y)throw new Error("Attempted to solve two different move subsets in the same worker using `twsearch`. This is not currently supported!");return await i(d("SearchState",t,!0))}var Z=null;async function Ce(){return Z||(Z=(async()=>{let e=await(await S).cachedData222();return new v(await w["2x2x2"].kpuzzle(),e,"URFLBD".split(""))})())}async function re(){await Ce()}async function oe(e,t=11){return s(),await T((await A.kpuzzle()).definition,e.experimentalToTransformation().transformationData,{moveSubset:"UFLR".split(""),maxDepth:t})}async function Oe(e,t=11){s();let{normalizedState:r,normalizationAlg:a}=$(e),o=await T((await A.kpuzzle()).definition,r.experimentalToTransformation().transformationData,{moveSubset:"UFLR".split(""),maxDepth:t});return a.concat(o)}async function Re(e,t){try{return(await Oe(e,t-1)).log(),!0}catch(r){if(r instanceof(await R).NoSolutionError)return!1;throw r}}function Fe(e){let t;for(let r of e.childAlgNodes()){let a=r.as(P);if(!a)throw new Error("Unexpected solution with a non-move node!");let{family:o}=a;if(t&&(t==="L"&&o==="R"||t==="R"&&o==="L"))return!0;t=o}return!1}async function ee(e){return s(),T((await A.kpuzzle()).definition,e.experimentalToTransformation().transformationData,{moveSubset:"UFLR".split(""),minDepth:11})}function Ie(e,t,r,a){q(r.stateData[t].pieces);let o=e.definition.orbits[t],n=r.stateData[t].orientation,i=0;for(let d=0;d<o.numPieces;d++){let c=K(o.numOrientations);n[d]=c,i+=c}a&&"orientationSum"in a&&(n[0]=((n[0]+a.orientationSum-i)%o.numOrientations+o.numOrientations)%o.numOrientations)}async function te(){let e=await w["2x2x2"].kpuzzle(),t=new b(e,JSON.parse(JSON.stringify(e.startState().stateData)));return Ie(e,"CORNERS",t,{orientationSum:0}),t}async function ae(){let e=await te();for(;await Re(e,4);)console.info("Filtered out a 2x2x2 state!"),e=await te();let t=e.experimentalToTransformation().invert().toKState(),r=await ee(t);for(;Fe(r);)r=await ee(t);return r}var F=l(()=>import("./search-dynamic-solve-4x4x4-GGYIVTZW.js"));var Be=[[null,"x","x2","x'","z","z'"],[null,"y","y2","y'"]];async function ne(){return(await F).initialize()}async function I(){return(await F).random444Scramble()}async function ie(){return E(await I(),Be)}function Ge(e){switch(e){case 5:return 60;case 6:return 80;default:return 100}}var Le=[["U","D"],["L","R"],["F","B"]],me=new Map;function Ne(e){let t=me.get(e);if(t)return t;let r=[];for(let a of Le){let o=[];r.push(o);for(let n of a){o.push(new M(n)),e>3&&o.push(new M(`${n}w`));for(let i=3;i<=e/2;i++)o.push(new M(`${n}w`,i))}}return me.set(e,r),r}async function y(e){let t=Ne(e),r=Ge(e),a=new D,o=0,n=new Set;for(;a.experimentalNumAlgNodes()<r;){let i=K(3);i!==o&&n.clear(),o=i;let d=z(t[o]),c=d.toString();n.has(c)||(n.add(c),a.push(new P(d,z([1,2,-1]))))}return a.toAlg()}var Ue=[[null,"3Rw","3Rw2","3Rw'","3Fw","3Fw'"],[null,"3Dw","3Dw2","3Dw'"]];async function se(){return E(await y(5),Ue)}var le=l(()=>import("./search-dynamic-solve-fto-SUJYCXXW.js"));var $t=l(()=>import("./search-dynamic-sgs-unofficial-VSWANF7R.js"));async function ce(){return s(),new x(await(await le).randomFTOScrambleString())}var ue=l(()=>import("./search-dynamic-solve-kilominx-KY5QON5O.js"));async function fe(){return s(),(await ue).getRandomKilominxScramble()}var pe=l(()=>import("./search-dynamic-solve-master_tetraminx-QHFFOVJK.js"));async function Se(){return s(),new x(await(await pe).randomMasterTetraminxScrambleString())}var We=2,de=null;async function $e(){return de||(de=(async()=>{let e=await(await S).cachedSGSDataMegaminx();return new v(await(await S).cachedMegaminxKPuzzleWithoutMO(),e,["U","R","F","L","BR","BL","FR","FL","DR","DL","B","D"])})())}async function we(e){s();let t=await $e(),r=JSON.parse(JSON.stringify(e.stateData));r.CENTERS.orientation=new Array(12).fill(0);let a=new b(await(await S).cachedMegaminxKPuzzleWithoutMO(),r);return await t.solve(a,We,()=>5)}var _e=3,ge=null;async function qe(){return ge||(ge=(async()=>{let e=await(await S).sgsDataPyraminx();return new v(await w.pyraminx.kpuzzle(),e,"RLUB".split(""))})())}async function B(e){return s(),await(await qe()).solve(e,_e,()=>3)}async function He(){return s(),k(await w.pyraminx.kpuzzle(),await(await S).sgsDataPyraminxFixedOrientation())}async function be(){return B(await He())}var ve=l(()=>import("./search-dynamic-sgs-unofficial-VSWANF7R.js"));async function he(){return s(),(await ve).getRandomRediCubeScramble()}var Qe=3,ye=null;async function je(){return ye||(ye=(async()=>{let e=await(await S).sgsDataSkewb();return new v(await(await S).skewbKPuzzleWithoutMOCached(),e,"RLUB".split(""))})())}async function Je(e){return new b(await(await S).skewbKPuzzleWithoutMOCached(),{CORNERS:e.stateData.CORNERS,CENTERS:{pieces:e.stateData.CENTERS.pieces,orientation:new Array(6).fill(0)}})}async function G(e){return s(),await(await je()).solve(await Je(e),Qe,a=>a.family==="y"?4:3)}async function Ve(){return k(await(await S).skewbKPuzzleWithoutMOCached(),await(await S).sgsDataSkewbFixedCorner())}async function xe(){return G(await Ve())}var Pe=l(()=>import("./search-dynamic-solve-sq1-NLHAG7GU.js"));async function Te(){return x.fromString(await(await Pe).getRandomSquare1ScrambleString())}var Xe=1e3;H(!0);var Me=!0;function Ye(e){Me=e}function ze(){return(typeof performance>"u"?Date:performance).now()}async function m(e,t,r){if(!Me)return t();let a=ze(),o=t();o?.then&&await o;let n=ze();return console.warn(`${e}${r?.isPrefetch?" (prefetched)":""}: ${Math.round(n-a)}ms`),o}var L=new Map,N=null;async function De(e,t){switch(e){case"222":return m("random222Scramble",ae,{isPrefetch:t?.isPrefetch});case"333":case"333oh":case"333ft":return m("random333Scramble",j,{isPrefetch:t?.isPrefetch});case"333fm":return m("random333FewestMovesScramble",X);case"333bf":case"333mb":return m("random333OrientedScramble",V);case"444":return m("random444Scramble",I,{isPrefetch:t?.isPrefetch});case"444bf":return m("random444OrientedScramble",ie);case"555":return m("bigCubeScramble(5)",y.bind(y,5));case"555bf":return m("oriented555RandomMoves",se);case"666":return m("bigCubeScramble(6)",y.bind(y,6));case"777":return m("bigCubeScramble(7)",y.bind(y,7));case"skewb":return m("randomSkewbFixedCornerScramble",xe);case"pyram":return m("randomPyraminxScrambleFixedOrientation",be);case"sq1":return m("getRandomSquare1Scramble",Te,{isPrefetch:t?.isPrefetch});case"fto":return m("randomFTOScramble",ce,{isPrefetch:t?.isPrefetch});case"master_tetraminx":return m("randomMasterTetraminxScramble",Se);case"kilominx":return m("randomKilominxScramble",fe,{isPrefetch:t?.isPrefetch});case"redi_cube":return m("randomRediCubeScramble",he,{isPrefetch:t?.isPrefetch});default:throw new Error(`unsupported event: ${e}`)}}var U="auto",Ze={initialize:async e=>{switch(e){case"222":return m("preInitialize222",re);case"333":case"333oh":case"333ft":return m("initialize333",J);case"444":return m("initialize444",ne);default:throw new Error(`unsupported event: ${e}`)}},setScramblePrefetchLevel(e){U=e},randomScrambleForEvent:async e=>{let t=L.get(e);return t?L.delete(e):t=De(e),U!=="none"&&t.then(()=>{N&&clearTimeout(N),N=setTimeout(()=>{L.set(e,De(e,{isPrefetch:!0}))},U==="immediate"?0:Xe)}),t},randomScrambleStringForEvent:async e=>(await Ze.randomScrambleForEvent(e)).toString(),solve333ToString:async e=>{let t=new b(await w["3x3x3"].kpuzzle(),e);return(await Q(t)).toString()},solve222ToString:async e=>{let t=new b(await w["2x2x2"].kpuzzle(),e);return(await oe(t)).toString()},solveSkewbToString:async e=>{let t=new b(await w.skewb.kpuzzle(),e);return(await G(t)).toString()},solvePyraminxToString:async e=>{let t=new b(await w.pyraminx.kpuzzle(),e);return(await B(t)).toString()},solveMegaminxToString:async e=>{let t=new b(await w.megaminx.kpuzzle(),e);return(await we(t)).toString()},setDebugMeasurePerf:async e=>{Ye(e)},solveTwsearchToString:async(e,t,r)=>(await T(e,t,r)).toString()};export{Ze as a};
//# sourceMappingURL=chunk-VCEJJ6IO.js.map
