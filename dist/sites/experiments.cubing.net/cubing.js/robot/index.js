import{a as c}from"../chunk-E2NCNLSG.js";import{c as l,g as n,h as u}from"../chunk-WX2LTJPA.js";import"../chunk-UW55Z7GB.js";import"../chunk-6JCOA7ZK.js";import"../chunk-JDD2UWSX.js";import"../chunk-MQN5DVPY.js";import"../chunk-LWA7II2Q.js";import"../chunk-5XPORB2B.js";import"../chunk-WKWCM3NN.js";import"../chunk-F3UND4MX.js";import"../chunk-S4ZNJEAB.js";import"../chunk-CM3DPZVF.js";import"../chunk-QIOL4UIE.js";import{j as a,q as i}from"../chunk-K5RKCHW3.js";import"../chunk-SYRP7SJ5.js";var d="BOGUS",s=class{constructor(){this.player=document.querySelector("twisty-player");this.inputButton=document.querySelector("#input");this.getStreamsButton=document.querySelector("#get-streams");this.streamSelect=document.querySelector("#stream-select");this.streamServer=new c;this.outputButton=document.querySelector("#output");this.recorderButton=document.querySelector("#recorder");this.pauseButton=document.querySelector("#pause");this.inputs=[];this.output=null;this.paused=!1;this.inputButton?.addEventListener("click",this.connectBluetoothPuzzleInput.bind(this)),this.getStreamsButton.addEventListener("click",this.getStreams.bind(this)),this.recorderButton.addEventListener("click",this.connectRecorder.bind(this)),this.outputButton.addEventListener("click",this.connectOutput.bind(this)),this.pauseButton.addEventListener("click",()=>this.togglePause()),this.connectKeyboardInput(),this.streamSelect.addEventListener("change",()=>this.onStreamSelect())}resetSession(){let t=Date.now();console.log("Setting session:",t),this.sentStorageName=`robot-sent-${t}`,this.recorderStorageName=`robot-recorded-${t}`}async connectKeyboardInput(){(await l()).addAlgLeafListener(this.onAlgLeaf.bind(this))}async connectRecorder(){this.recorderButton.disabled=!0;try{let t=await n();this.inputs.push(t),t.addAlgLeafListener(this.recordAlgLeaf.bind(this)),this.recorderButton.textContent=`Recorder: ${t.name()??"[unknown]"}`}catch{this.recorderButton.disabled=!1}}async getStreams(){let t=await this.streamServer.streams();this.streamSelect.textContent="",this.streamSelect.disabled=!1;let e=this.streamSelect.appendChild(document.createElement("option"));e.textContent=`Select a stream (${t.length} available)`,e.value=d;for(let o of t){let m=o.senders[0],r=this.streamSelect.appendChild(document.createElement("option"));r.value=o.streamID,r.textContent=`${m.name} (0x${o.streamID.slice(-2)})`}}onStreamSelect(){let t=this.streamSelect.value;if(t===d)return;this.streamServer.connect(t).addEventListener("move",o=>{console.log("Incoming stream move:",o.detail.move.toString()),this.onAlgLeaf({latestAlgLeaf:o.detail.move,timeStamp:Date.now()})})}async connectBluetoothPuzzleInput(){this.inputButton.disabled=!0;try{let t=await n();this.inputs.push(t),t.addAlgLeafListener(this.onAlgLeaf.bind(this)),this.inputButton.textContent=`Input: ${t.name()??"[unknown]"}`}catch{this.inputButton.disabled=!1}this.pauseButton.disabled=!1}async connectOutput(){this.outputButton.disabled=!0;try{this.output=await u(),this.output.experimentalDebugLog=console.log,this.output.experimentalOptions.singleMoveFixHack=!0,this.output.experimentalOptions.xAngle=!1,this.output.experimentalDebugOnSend=t=>{localStorage[this.sentStorageName]=`${localStorage[this.sentStorageName]??""}${t.toString()} // ${Date.now()}
`},this.outputButton.textContent=`Output: ${this.output.name()??"[unknown]"}`}catch{this.outputButton.disabled=!1}}applyAlgString(t){let e=i.fromString(t);for(let o of e.experimentalLeafMoves())this.player.experimentalAddMove(o);this.output?.applyMoves(Array.from(e.experimentalLeafMoves()))}onAlgLeaf(t){if(this.player.experimentalAddAlgLeaf(t.latestAlgLeaf),this.paused)console.log("Paused. Not sending moves.");else{let e=t.latestAlgLeaf.as(a);if(!e)return;this.output?.applyMoves([e])}}recordAlgLeaf(t){localStorage[this.recorderStorageName]=`${localStorage[this.recorderStorageName]??""}${t.latestAlgLeaf.toString()} // ${Date.now()}
`}togglePause(t){if(typeof t>"u"){this.togglePause(!this.paused);return}console.log("Setting pause:",t),this.resetSession(),t?(this.pauseButton.textContent="\u25B6\uFE0F",this.paused=t):(this.pauseButton.textContent="\u23F8",this.paused=t)}};window.robotDemo=new s;
//# sourceMappingURL=index.js.map
