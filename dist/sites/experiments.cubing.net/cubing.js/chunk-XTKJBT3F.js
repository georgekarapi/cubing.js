import{i as C,j as B}from"./chunk-K5RKCHW3.js";import{c as gt}from"./chunk-SYRP7SJ5.js";var Ct={};gt(Ct,{EXPERIMENTAL_PUZZLE_BASE_SHAPES:()=>ft,EXPERIMENTAL_PUZZLE_CUT_TYPES:()=>ht,ExperimentalPGNotation:()=>Ne,PuzzleGeometry:()=>xe,Quat:()=>N,getPG3DNamedPuzzles:()=>ct,getPuzzleDescriptionString:()=>ut,getPuzzleGeometryByDesc:()=>Ke,getPuzzleGeometryByName:()=>pt,parseOptions:()=>qe,parsePuzzleDescription:()=>ze,schreierSims:()=>Re});var ue=class{constructor(e,t){this.facenames=e;this.prefixFree=!0;this.gripnames=[];t&&(this.gripnames=t);for(let n=0;this.prefixFree&&n<e.length;n++)for(let s=0;this.prefixFree&&s<e.length;s++)n!==s&&e[n].startsWith(e[s])&&(this.prefixFree=!1)}setGripNames(e){this.gripnames=e}splitByFaceNames(e){let t=[],n=0;for(;n<e.length;){n>0&&n<e.length&&e[n]==="_"&&n++;let s=-1;for(let i=0;i<this.facenames.length;i++)e.substr(n).startsWith(this.facenames[i])&&(s<0||this.facenames[i].length>this.facenames[s].length)&&(s=i);if(s>=0)t.push(s),n+=this.facenames[s].length;else throw new Error(`Could not split ${e} into face names.`)}return t}joinByFaceIndices(e){let t="",n=[];for(let s=0;s<e.length;s++)n.push(t),n.push(this.facenames[e[s]]),this.prefixFree||(t="_");return n.join("")}spinmatch(e,t){if(e===t)return!0;try{let n=this.splitByFaceNames(e),s=this.splitByFaceNames(t);if(n.length!==s.length&&n.length<3)return!1;for(let i=0;i<n.length;i++){for(let o=0;o<i;o++)if(n[i]===n[o])return!1;let r=!1;for(let o=0;o<s.length;o++)if(n[i]===s[o]){r=!0;break}if(!r)return!1}return!0}catch{return!1}}spinmatchv(e,t){return e.endsWith("v")&&t.endsWith("v")?this.spinmatch(e.slice(0,e.length-1),t.slice(0,t.length-1)):this.spinmatch(e,t)}unswizzle(e){(e.endsWith("v")||e.endsWith("w"))&&e[0]<="Z"&&(e=e.slice(0,e.length-1));let t=e.toUpperCase();for(let n=0;n<this.gripnames.length;n++){let s=this.gripnames[n];if(this.spinmatch(t,s))return s}return e}};var ae=class{notationToInternal(e){return e}notationToExternal(e){return e}};var de=class{constructor(e,t){this.child=e;this.sw=t}notationToInternal(e){return e.family==="T"&&e.innerLayer===void 0&&e.outerLayer===void 0?new B(new C("FLRv",e.innerLayer,e.outerLayer),e.amount):this.child.notationToInternal(e)}notationToExternal(e){let t=e.family;return t.length>0&&t[t.length-1]==="v"&&(t=t.substring(0,t.length-1)),this.sw.spinmatch(t,"FLUR")?new B(new C("T",e.innerLayer,e.outerLayer),e.amount):this.child.notationToExternal(e)}};var fe=class{constructor(e,t){this.internalNames=e;this.externalNames=t}convertString(e,t,n){let s="";(e.endsWith("v")||e.endsWith("v"))&&e<="_"&&(s=e.slice(e.length-1),e=e.slice(0,e.length-1));let i=e.toUpperCase(),r=!1;return e!==i&&(r=!0,e=i),e=n.joinByFaceIndices(t.splitByFaceNames(e)),r&&(e=e.toLowerCase()),e+s}convert(e,t,n){let s=e.family,i=this.convertString(s,t,n);return s===i?e:new B(new C(i,e.innerLayer,e.outerLayer),e.amount)}notationToInternal(e){return this.convert(e,this.externalNames,this.internalNames)}notationToExternal(e){return this.convert(e,this.internalNames,this.externalNames)}};var ge=class{constructor(e){this.child=e}notationToInternal(e){if(e.innerLayer===void 0&&e.outerLayer===void 0){if(Math.abs(e.amount)===1){if(e.family==="R++")return new B(new C("L",3,2),-2*e.amount);if(e.family==="R--")return new B(new C("L",3,2),2*e.amount);if(e.family==="D++")return new B(new C("U",3,2),-2*e.amount);if(e.family==="D--")return new B(new C("U",3,2),2*e.amount);if(e.family==="R_PLUSPLUS_")return new B(new C("L",3,2),-2*e.amount);if(e.family==="D_PLUSPLUS_")return new B(new C("U",3,2),-2*e.amount)}if(e.family==="y")return new B("Uv",e.amount);if(e.family==="x"&&Math.abs(e.amount)===2)return new B("ERv",e.amount/2)}return this.child.notationToInternal(e)}notationToExternal(e){return e.family==="ERv"&&Math.abs(e.amount)===1?new B(new C("x",e.innerLayer,e.outerLayer),e.amount*2):e.family==="ILv"&&Math.abs(e.amount)===1?new B(new C("x",e.innerLayer,e.outerLayer),-e.amount*2):e.family==="Uv"?new B(new C("y",e.innerLayer,e.outerLayer),e.amount):e.family==="Dv"?new B("y",-e.amount):this.child.notationToExternal(e)}};var ve=class{constructor(e){this.slices=e}notationToInternal(e){let t=e.family;return e.innerLayer||e.outerLayer||(t==="x"?e=new B("Rv",e.amount):t==="y"?e=new B("Uv",e.amount):t==="z"&&(e=new B("Fv",e.amount)),(this.slices&1)===1&&(t==="E"?e=new B(new C("D",(this.slices+1)/2),e.amount):t==="M"?e=new B(new C("L",(this.slices+1)/2),e.amount):t==="S"&&(e=new B(new C("F",(this.slices+1)/2),e.amount))),this.slices>2&&(t==="e"?e=new B(new C("D",this.slices-1,2),e.amount):t==="m"?e=new B(new C("L",this.slices-1,2),e.amount):t==="s"&&(e=new B(new C("F",this.slices-1,2),e.amount)))),e}notationToExternal(e){let t=e.family;if(!(e.innerLayer||e.outerLayer)){if(t==="Rv")return new B("x",e.amount);if(t==="Uv")return new B("y",e.amount);if(t==="Fv")return new B("z",e.amount);if(t==="Lv")return new B("x",-e.amount);if(t==="Dv")return new B("y",-e.amount);if(t==="Bv")return new B("z",-e.amount)}return e}};var vt={U:"frl",L:"fld",R:"fdr",B:"dlr",u:"FRL",l:"FLD",r:"FDR",b:"DLR",Uv:"FRLv",Lv:"FLDv",Rv:"FDRv",Bv:"DLRv",D:"D",F:"F",BL:"L",BR:"R"},wt={U:"FRL",L:"FLD",R:"FDR",B:"DLR",u:"frl",l:"fld",r:"fdr",b:"dlr",Uv:"FRLv",Lv:"FLDv",Rv:"FDRv",Bv:"DLRv",D:"D",F:"F",BL:"L",BR:"R",d:"d",f:"f",bl:"l",br:"r"},Ze={U:"FRL",L:"FLD",R:"FDR",B:"DLR"},He=new C("y"),Je=new C("Dv"),he=class{constructor(e){this.child=e;this.wcaHack=!1;this.map=vt}notationToInternal(e){if(this.wcaHack&&e.innerLayer===2&&e.outerLayer===null){let n=Ze[e.family];if(n)return new B(new C(n,e.innerLayer,e.outerLayer),e.amount)}let t=this.map[e.family];return t?new B(new C(t,e.innerLayer,e.outerLayer),e.amount):He.isIdentical(e.quantum)?new B(Je,-e.amount):null}notationToExternal(e){if(this.wcaHack&&e.innerLayer===2&&e.outerLayer===null){for(let[t,n]of Object.entries(Ze))if(this.child.spinmatch(e.family,n))return new B(new C(t,e.innerLayer,e.outerLayer),e.amount)}for(let[t,n]of Object.entries(this.map))if(this.child.spinmatch(e.family,n))return new B(new C(t,e.innerLayer,e.outerLayer),e.amount);return Je.isIdentical(e.quantum)?new B(He,-e.amount):null}},we=class extends he{constructor(t){super(t);this.wcaHack=!0;this.map=wt}};var We={U:"UBL",UL:"ULF",F:"UFR",UR:"URB",B:"DBL",D:"DFR",L:"DLF",R:"DRB",Uv:"UBLv",ULv:"ULFv",Fv:"UFRv",URv:"URBv",Bv:"DBLv",Dv:"DFRv",Lv:"DLFv",Rv:"DRBv"},Ce=new C("x"),Ye=new C("Rv"),yt=new C("Lv"),Se=new C("y"),Ve=new C("Uv"),zt=new C("Dv"),Qe=new C("z"),Xe=new C("Fv"),xt=new C("Bv"),ye=class{constructor(e){this.child=e}notationToInternal(e){if(e.innerLayer||e.outerLayer)return null;let t=We[e.family];return t?new B(new C(t,e.outerLayer,e.innerLayer),e.amount):Ce.isIdentical(e.quantum)?new B(Ye,e.amount):Se.isIdentical(e.quantum)?new B(Ve,e.amount):Qe.isIdentical(e.quantum)?new B(Xe,e.amount):null}notationToExternal(e){for(let[t,n]of Object.entries(We))if(this.child.spinmatchv(e.family,n))return new B(new C(t,e.innerLayer,e.outerLayer),e.amount);return Ye.isIdentical(e.quantum)?new B(Ce,e.amount):yt.isIdentical(e.quantum)?new B(Ce,-e.amount):Ve.isIdentical(e.quantum)?new B(Se,e.amount):zt.isIdentical(e.quantum)?new B(Se,-e.amount):Xe.isIdentical(e.quantum)?new B(Qe,e.amount):xt.isIdentical(e.quantum)?new B(Qe,-e.amount):null}};function qe(c){let e=0,t={};for(;e<c.length&&c[e][0]==="-";){let s=c[e++];if(s==="--rotations")t.addRotations=!0;else if(s==="--allmoves")t.allMoves=!0;else if(s==="--outerblockmoves")t.outerBlockMoves=!0;else if(s==="--vertexmoves")t.vertexMoves=!0;else if(s==="--nocorners")t.includeCornerOrbits=!1;else if(s==="--noedges")t.includeEdgeOrbits=!1;else if(s==="--noorientation")t.fixedOrientation=!0;else if(s==="--nocenters")t.includeCenterOrbits=!1;else if(s==="--omit")t.excludeOrbits=c[e].split(","),e++;else if(s==="--moves")t.moveList=c[e].split(","),e++;else if(s==="--optimize")t.optimizeOrbits=!0;else if(s==="--scramble")t.scrambleAmount=100;else if(s==="--fixcorner")t.fixedPieceType="v";else if(s==="--fixedge")t.fixedPieceType="e";else if(s==="--fixcenter")t.fixedPieceType="f";else if(s==="--orientcenters")t.orientCenters=!0;else if(s==="--puzzleorientation")t.puzzleOrientation=JSON.parse(c[e]),e++;else throw new Error(`Bad option: ${s}`)}return{puzzleDescription:ze(c.slice(e).join(" ")),options:t}}var Me=class{constructor(e={}){this.verbosity=0;this.allMoves=!1;this.vertexMoves=!1;this.addRotations=!1;this.moveList=null;this.fixedOrientation=!1;this.fixedPieceType=null;this.orientCenters=!1;this.includeCornerOrbits=!0;this.includeCenterOrbits=!0;this.includeEdgeOrbits=!0;this.excludeOrbits=[];this.optimizeOrbits=!1;this.grayCorners=!1;this.grayCenters=!1;this.grayEdges=!1;this.puzzleOrientation=null;this.puzzleOrientations=null;this.scrambleAmount=0;Object.assign(this,e)}};var je=[],Ue=[];function ie(c){if(!je[c]){let e=Array(c);for(let t=0;t<c;t++)e[t]=0;je[c]=e}return je[c]}function _(c){if(!Ue[c]){let e=Array(c);for(let t=0;t<c;t++)e[t]=t;Ue[c]=e}return Ue[c]}function _e(c){return new X(_(c))}function et(c){let e=BigInt(1);for(;c>1;)e*=BigInt(c),c--;return e}function Mt(c,e){if(c>e){let t=c;c=e,e=t}for(;c>0;){let t=e%c;e=c,c=t}return e}function Te(c,e){return c/Mt(c,e)*e}var X=class{constructor(e){this.n=e.length,this.p=e}toString(){return`Perm[${this.p.join(" ")}]`}mul(e){let t=Array(this.n);for(let n=0;n<this.n;n++)t[n]=e.p[this.p[n]];return new X(t)}rmul(e){let t=Array(this.n);for(let n=0;n<this.n;n++)t[n]=this.p[e.p[n]];return new X(t)}inv(){let e=Array(this.n);for(let t=0;t<this.n;t++)e[this.p[t]]=t;return new X(e)}compareTo(e){for(let t=0;t<this.n;t++)if(this.p[t]!==e.p[t])return this.p[t]-e.p[t];return 0}toGap(){let e=new Array,t=new Array(this.n);for(let n=0;n<this.p.length;n++){if(t[n]||this.p[n]===n)continue;let s=new Array;for(let i=n;!t[i];i=this.p[i])s.push(1+i),t[i]=!0;e.push(`(${s.join(",")})`)}return e.join("")}order(){let e=1,t=new Array(this.n);for(let n=0;n<this.p.length;n++){if(t[n]||this.p[n]===n)continue;let s=0;for(let i=n;!t[i];i=this.p[i])s++,t[i]=!0;e=Te(e,s)}return e}};var pe=class{constructor(e,t){this.size=e;this.mod=t}reassemblySize(){return et(this.size)*BigInt(this.mod)**BigInt(this.size)}},Ft=0;function Fe(c,e){let t=B.fromString(e),n=c.notationToExternal(t);return n===null||t===n?e:n.toString()}var le=class{constructor(e,t,n,s,i,r,o){this.orbitnames=e;this.orbitdefs=t;this.solved=n;this.movenames=s;this.moveops=i;this.isRotation=r;this.forcenames=o}transformToKTransformationData(e){let t={};for(let n=0;n<this.orbitnames.length;n++)t[this.orbitnames[n]]=e.orbits[n].toKPuzzle();return t}static transformToKTransformationData(e,t){let n={};for(let s=0;s<e.length;s++)n[e[s]]=t.orbits[s].toKPuzzle();return n}describeSet(e,t,n){let s=this.orbitdefs[e].size,i=new Array(s);for(let r=0;r<s;r++)i[r]=[];for(let r=0;r<this.movenames.length;r++){if(this.isRotation[r])continue;let o=this.movenames[r];this.forcenames[r]||(o=Fe(n,o),o[o.length-1]==="'"&&(o=o.substring(0,o.length-1)));let v=this.moveops[r].orbits[e];for(let f=0;f<s;f++)(v.perm[f]!==f||v.ori[f]!==0)&&i[f].push(o)}for(let r=0;r<s;r++)t.push(`# ${r+1} ${i[r].join(" ")}`)}toKsolve(e,t=new ae){let n=[];n.push(`Name ${e}`),n.push("");for(let s=0;s<this.orbitnames.length;s++)n.push(`Set ${this.orbitnames[s]} ${this.orbitdefs[s].size} ${this.orbitdefs[s].mod}`),this.describeSet(s,n,t);n.push(""),n.push("Solved");for(let s=0;s<this.orbitnames.length;s++)this.solved.orbits[s].appendDefinition(n,this.orbitnames[s],!1,!1);n.push("End");for(let s=0;s<this.movenames.length;s++){n.push("");let i=this.movenames[s];this.forcenames[s]||(i=Fe(t,this.movenames[s]));let r=!1;i[i.length-1]==="'"&&(r=!0,i=i.substring(0,i.length-1)),n.push(`Move ${i}`);for(let o=0;o<this.orbitnames.length;o++)r?this.moveops[s].orbits[o].inv().appendDefinition(n,this.orbitnames[o],!0):this.moveops[s].orbits[o].appendDefinition(n,this.orbitnames[o],!0);n.push("End")}return n}toKPuzzleDefinition(e){let t={},n={};for(let i=0;i<this.orbitnames.length;i++){t[this.orbitnames[i]]={numPieces:this.orbitdefs[i].size,numOrientations:this.orbitdefs[i].mod};let r=this.solved.orbits[i].toKPuzzle();n[this.orbitnames[i]]={pieces:r.permutation,orientation:r.orientation}}let s={};if(e)for(let i=0;i<this.movenames.length;i++)s[this.movenames[i]]=this.transformToKTransformationData(this.moveops[i]);return{name:`PG3D #${++Ft}`,orbits:t,startStateData:n,moves:s}}optimize(){let e=[],t=[],n=[],s=[];for(let i=0;i<this.moveops.length;i++)s.push([]);for(let i=0;i<this.orbitdefs.length;i++){let r=this.orbitdefs[i].mod,o=this.orbitdefs[i].size,v=new Be(o),f=new Array(this.orbitdefs[i].size);for(let u=0;u<o;u++)f[u]=!1;for(let u=0;u<this.moveops.length;u++)for(let p=0;p<o;p++)(this.moveops[u].orbits[i].perm[p]!==p||this.moveops[u].orbits[i].ori[p]!==0)&&(this.isRotation[u]||(f[p]=!0),v.union(p,this.moveops[u].orbits[i].perm[p]));let m=!0;if(r>1){m=!1;let u=new Be(this.orbitdefs[i].size*r);for(let p=0;p<this.moveops.length;p++)for(let a=0;a<o;a++)if(this.moveops[p].orbits[i].perm[a]!==a||this.moveops[p].orbits[i].ori[a]!==0)for(let h=0;h<r;h++)u.union(a*r+h,this.moveops[p].orbits[i].perm[a]*r+(h+this.moveops[p].orbits[i].ori[a])%r);for(let p=0;!m&&p<o;p++)for(let a=1;a<r;a++)u.find(p*r)===u.find(p*r+a)&&(m=!0);for(let p=0;!m&&p<o;p++)for(let a=0;a<p;a++)this.solved.orbits[i].perm[p]===this.solved.orbits[i].perm[a]&&(m=!0)}let b=-1,g=!1;for(let u=0;u<this.orbitdefs[i].size;u++)if(f[u]){let p=v.find(u);b<0?b=p:b!==p&&(g=!0)}for(let u=0;u<this.orbitdefs[i].size;u++){if(!f[u]||v.find(u)!==u)continue;let a=[],h=[],F=0;for(let M=0;M<this.orbitdefs[i].size;M++)v.find(M)===u&&(a[F]=M,h[M]=F,F++);if(g?e.push(`${this.orbitnames[i]}_p${u}`):e.push(this.orbitnames[i]),m){t.push(new pe(F,this.orbitdefs[i].mod)),n.push(this.solved.orbits[i].remapVS(a,F));for(let M=0;M<this.moveops.length;M++)s[M].push(this.moveops[M].orbits[i].remap(a,h,F))}else{t.push(new pe(F,1)),n.push(this.solved.orbits[i].remapVS(a,F).killOri());for(let M=0;M<this.moveops.length;M++)s[M].push(this.moveops[M].orbits[i].remap(a,h,F).killOri())}}}return new le(e,t,new ce(n),this.movenames,s.map(i=>new te(i)),this.isRotation,this.forcenames)}scramble(e){this.solved=this.solved.mul(this.getScrambleTransformation(e))}getScrambleTransformation(e){e<100&&(e=100);let t=[];for(let s=0;s<this.moveops.length;s++)t[s]=this.moveops[s];for(let s=0;s<t.length;s++){let i=Math.floor(Math.random()*t.length),r=t[s];t[s]=t[i],t[i]=r}e<t.length&&(e=t.length);for(let s=0;s<e;s++){let i=Math.floor(Math.random()*t.length),r=Math.floor(Math.random()*t.length),o=Math.floor(Math.random()*this.moveops.length);t[i]=t[i].mul(t[r]).mul(this.moveops[o]),Math.random()<.1&&(t[i]=t[i].mul(this.moveops[o]))}let n=t[0];for(let s=1;s<t.length;s++)n=n.mul(t[s]);return n}reassemblySize(){let e=BigInt(1);for(let t=0;t<this.orbitdefs.length;t++)e*=this.orbitdefs[t].reassemblySize();return e}},q=class{constructor(e,t,n){this.perm=e;this.ori=t;this.orimod=n}static e(e,t){return new q(_(e),ie(e),t)}mul(e){let t=this.perm.length,n=new Array(t);if(this.orimod===1){for(let s=0;s<t;s++)n[s]=this.perm[e.perm[s]];return new q(n,this.ori,this.orimod)}else{let s=new Array(t);for(let i=0;i<t;i++)n[i]=this.perm[e.perm[i]],s[i]=(this.ori[e.perm[i]]+e.ori[i])%this.orimod;return new q(n,s,this.orimod)}}inv(){let e=this.perm.length,t=new Array(e),n=new Array(e);for(let s=0;s<e;s++)t[this.perm[s]]=s,n[this.perm[s]]=(this.orimod-this.ori[s])%this.orimod;return new q(t,n,this.orimod)}equal(e){let t=this.perm.length;for(let n=0;n<t;n++)if(this.perm[n]!==e.perm[n]||this.ori[n]!==e.ori[n])return!1;return!0}killOri(){let e=this.perm.length;for(let t=0;t<e;t++)this.ori[t]=0;return this.orimod=1,this}toPerm(){let e=this.orimod;if(e===1)return new X(this.perm);let t=this.perm.length,n=new Array(t*e);for(let s=0;s<t;s++)for(let i=0;i<e;i++)n[s*e+i]=e*this.perm[s]+(this.ori[s]+i)%e;return new X(n)}identicalPieces(){let e=[],t=this.perm.length,n=[];for(let s=0;s<t;s++){let i=this.perm[s];if(e[i]===void 0){let r=[s];e[i]=!0;for(let o=s+1;o<t;o++)this.perm[o]===i&&r.push(o);n.push(r)}}return n}order(){return this.toPerm().order()}isIdentity(){let e=this.perm.length;if(this.perm===_(e)&&this.ori===ie(e))return!0;for(let t=0;t<e;t++)if(this.perm[t]!==t||this.ori[t]!==0)return!1;return!0}zeroOris(){let e=this.perm.length;if(this.ori===ie(e))return!0;for(let t=0;t<e;t++)if(this.ori[t]!==0)return!1;return!0}remap(e,t,n){let s=new Array(n),i=new Array(n);for(let r=0;r<n;r++)s[r]=t[this.perm[e[r]]],i[r]=this.ori[e[r]];return new q(s,i,this.orimod)}remapVS(e,t){let n=new Array(t),s=new Array(t),i=0,r=[];for(let o=0;o<t;o++){let v=this.perm[e[o]];r[v]===void 0&&(r[v]=i++),n[o]=r[v],s[o]=this.ori[e[o]]}return new q(n,s,this.orimod)}appendDefinition(e,t,n,s=!0){if(!(s&&this.isIdentity())&&(e.push(t),e.push(this.perm.map(i=>i+1).join(" ")),!this.zeroOris()))if(n){let i=new Array(this.ori.length);for(let r=0;r<i.length;r++)i[this.perm[r]]=this.ori[r];e.push(i.join(" "))}else e.push(this.ori.join(" "))}toKPuzzle(){let e=this.perm.length;return this.isIdentity()?(q.kcache[e]||(q.kcache[e]={permutation:_(e),orientation:ie(e)}),q.kcache[e]):{permutation:this.perm,orientation:this.ori}}},ee=q;ee.kcache=[];var De=class{constructor(e){this.orbits=e}internalMul(e){let t=[];for(let n=0;n<this.orbits.length;n++)t.push(this.orbits[n].mul(e.orbits[n]));return t}internalInv(){let e=[];for(let t of this.orbits)e.push(t.inv());return e}equal(e){for(let t=0;t<this.orbits.length;t++)if(!this.orbits[t].equal(e.orbits[t]))return!1;return!0}killOri(){for(let e of this.orbits)e.killOri();return this}toPerm(){let e=new Array,t=0;for(let s of this.orbits){let i=s.toPerm();e.push(i),t+=i.n}let n=new Array(t);t=0;for(let s of e){for(let i=0;i<s.n;i++)n[t+i]=t+s.p[i];t+=s.n}return new X(n)}identicalPieces(){let e=[],t=0;for(let n of this.orbits){let s=n.orimod,i=n.identicalPieces();for(let r=0;r<i.length;r++)e.push(i[r].map(o=>o*s+t));t+=s*n.perm.length}return e}order(){let e=1;for(let t of this.orbits)e=Te(e,t.order());return e}},te=class extends De{constructor(e){super(e)}mul(e){return new te(this.internalMul(e))}mulScalar(e){if(e===0)return this.e();let t=this;for(e<0&&(t=t.inv(),e=-e);(e&1)===0;)t=t.mul(t),e>>=1;if(e===1)return t;let n=t,s=this.e();for(;e>0;)e&1&&(s=s.mul(n)),e>1&&(n=n.mul(n)),e>>=1;return s}inv(){return new te(this.internalInv())}e(){return new te(this.orbits.map(e=>ee.e(e.perm.length,e.orimod)))}},ce=class extends De{constructor(e){super(e)}mul(e){return new ce(this.internalMul(e))}},Be=class{constructor(e){this.n=e;this.heads=new Array(e);for(let t=0;t<e;t++)this.heads[t]=t}find(e){let t=this.heads[e];return this.heads[t]===t||(t=this.find(this.heads[t]),this.heads[e]=t),t}union(e,t){let n=this.find(e),s=this.find(t);n<s?this.heads[s]=n:n>s&&(this.heads[n]=s)}};function tt(c,e){let t=c.moveops.length;if(t>30)throw new Error("Canon info too big for bitmask");let n=[],s=[];for(let r=0;r<t;r++){let o=c.moveops[r];n.push(o.order());let v=0;for(let f=0;f<t;f++){if(f===r)continue;let m=c.moveops[f];o.mul(m).equal(m.mul(o))&&(v|=1<<f)}s.push(v)}let i={};i[0]=1;for(let r=0;r<100;r++){let o=0,v={},f=0;for(let m in i){let b=+m,g=i[b];o+=g,f++;for(let u=0;u<n.length;u++)if((b>>u&1)===0&&(b&s[u]&(1<<u)-1)===0){let p=b&s[u]|1<<u;v[p]===void 0&&(v[p]=0),v[p]+=(n[u]-1)*g}}e(`${r}: canonseq ${o} states ${f}`),i=v}}var Pe={"2x2x2":"c f 0","3x3x3":"c f 0.333333333333333","4x4x4":"c f 0.5 f 0","5x5x5":"c f 0.6 f 0.2","6x6x6":"c f 0.666666666666667 f 0.333333333333333 f 0","7x7x7":"c f 0.714285714285714 f 0.428571428571429 f 0.142857142857143","8x8x8":"c f 0.75 f 0.5 f 0.25 f 0","9x9x9":"c f 0.777777777777778 f 0.555555555555556 f 0.333333333333333 f 0.111111111111111","10x10x10":"c f 0.8 f 0.6 f 0.4 f 0.2 f 0","11x11x11":"c f 0.818181818181818 f 0.636363636363636 f 0.454545454545455 f 0.272727272727273 f 0.0909090909090909","12x12x12":"c f 0.833333333333333 f 0.666666666666667 f 0.5 f 0.333333333333333 f 0.166666666666667 f 0","13x13x13":"c f 0.846153846153846 f 0.692307692307692 f 0.538461538461538 f 0.384615384615385 f 0.230769230769231 f 0.0769230769230769","20x20x20":"c f 0 f .1 f .2 f .3 f .4 f .5 f .6 f .7 f .8 f .9","30x30x30":"c f 0 f .066667 f .133333 f .2 f .266667 f .333333 f .4 f .466667 f .533333 f .6 f .666667 f .733333 f .8 f .866667 f .933333","40x40x40":"c f 0 f .05 f .1 f .15 f .2 f .25 f .3 f .35 f .4 f .45 f .5 f .55 f .6 f .65 f .7 f .75 f .8 f .85 f .9 f .95",skewb:"c v 0","master skewb":"c v 0.275","professor skewb":"c v 0 v 0.38","compy cube":"c v 0.915641442663986",helicopter:"c e 0.707106781186547","curvy copter":"c e 0.83",dino:"c v 0.577350269189626","little chop":"c e 0",pyramorphix:"t e 0",mastermorphix:"t e 0.346184634065199",pyraminx:"t v 0.333333333333333 v 1.66666666666667",tetraminx:"t v 0.333333333333333","master pyraminx":"t v 0 v 1 v 2","master tetraminx":"t v 0 v 1","professor pyraminx":"t v -0.2 v 0.6 v 1.4 v 2.2","professor tetraminx":"t v -0.2 v 0.6 v 1.4","Jing pyraminx":"t f 0","master pyramorphix":"t e 0.866025403784437",megaminx:"d f 0.7",gigaminx:"d f 0.64 f 0.82",teraminx:"d f 0.64 f 0.76 f 0.88",petaminx:"d f 0.64 f 0.73 f 0.82 f 0.91",examinx:"d f 0.64 f 0.712 f 0.784 f 0.856 f 0.928",zetaminx:"d f 0.64 f 0.7 f 0.76 f 0.82 f 0.88 f 0.94",yottaminx:"d f 0.64 f 0.6914 f 0.7429 f 0.7943 f 0.8457 f 0.8971 f 0.9486",pentultimate:"d f 0","master pentultimate":"d f 0.1","elite pentultimate":"d f 0 f 0.145905",starminx:"d v 0.937962370425399","starminx 2":"d f 0.23606797749979","pyraminx crystal":"d f 0.447213595499989",chopasaurus:"d v 0","big chop":"d e 0","skewb diamond":"o f 0",FTO:"o f 0.333333333333333","master FTO":"o f 0.5 f 0","Christopher's jewel":"o v 0.577350269189626",octastar:"o e 0","Trajber's octahedron":"o v 0.433012701892219","radio chop":"i f 0",icosamate:"i v 0","icosahedron 2":"i v 0.18759247376021","icosahedron 3":"i v 0.18759247376021 e 0","icosahedron static faces":"i v 0.84","icosahedron moving faces":"i v 0.73","Eitan's star":"i f 0.61803398874989","2x2x2 + dino":"c f 0 v 0.577350269189626","2x2x2 + little chop":"c f 0 e 0","dino + little chop":"c v 0.577350269189626 e 0","2x2x2 + dino + little chop":"c f 0 v 0.577350269189626 e 0","megaminx + chopasaurus":"d f 0.61803398875 v 0","starminx combo":"d f 0.23606797749979 v 0.937962370425399"};function Le(c){let e=new N(0,0,0,0);for(let t=0;t<c.length;t++)e=e.sum(c[t]);return e.smul(1/c.length)}function nt(c,e,t,n){let s=n[c].intersect3(n[e],n[t]);if(!s)return s;for(let i=0;i<n.length;i++)if(i!==c&&i!==e&&i!==t){let r=n[i].b*s.b+n[i].c*s.c+n[i].d*s.d;if(n[i].a>0&&r>n[i].a||n[i].a<0&&r<n[i].a)return!1}return s}var N=class{constructor(e,t,n,s){this.a=e;this.b=t;this.c=n;this.d=s}mul(e){return new N(this.a*e.a-this.b*e.b-this.c*e.c-this.d*e.d,this.a*e.b+this.b*e.a+this.c*e.d-this.d*e.c,this.a*e.c-this.b*e.d+this.c*e.a+this.d*e.b,this.a*e.d+this.b*e.c-this.c*e.b+this.d*e.a)}toString(){return`Q[${this.a},${this.b},${this.c},${this.d}]`}dist(e){return Math.hypot(this.a-e.a,this.b-e.b,this.c-e.c,this.d-e.d)}len(){return Math.hypot(this.a,this.b,this.c,this.d)}cross(e){return new N(0,this.c*e.d-this.d*e.c,this.d*e.b-this.b*e.d,this.b*e.c-this.c*e.b)}dot(e){return this.b*e.b+this.c*e.c+this.d*e.d}normalize(){let e=Math.sqrt(this.dot(this));return new N(this.a/e,this.b/e,this.c/e,this.d/e)}makenormal(){return new N(0,this.b,this.c,this.d).normalize()}normalizeplane(){let e=Math.hypot(this.b,this.c,this.d);return new N(this.a/e,this.b/e,this.c/e,this.d/e)}smul(e){return new N(this.a*e,this.b*e,this.c*e,this.d*e)}sum(e){return new N(this.a+e.a,this.b+e.b,this.c+e.c,this.d+e.d)}sub(e){return new N(this.a-e.a,this.b-e.b,this.c-e.c,this.d-e.d)}angle(){return 2*Math.acos(this.a)}invrot(){return new N(this.a,-this.b,-this.c,-this.d)}det3x3(e,t,n,s,i,r,o,v,f){return e*(i*f-r*v)+t*(r*o-s*f)+n*(s*v-i*o)}rotateplane(e){let t=e.mul(new N(0,this.b,this.c,this.d)).mul(e.invrot());return t.a=this.a,t}orthogonal(){let e=Math.abs(this.b),t=Math.abs(this.c),n=Math.abs(this.d);return e<t&&e<n?this.cross(new N(0,1,0,0)).normalize():t<e&&t<n?this.cross(new N(0,0,1,0)).normalize():this.cross(new N(0,0,0,1)).normalize()}pointrotation(e){let t=this.normalize();if(e=e.normalize(),t.sub(e).len()<1e-9)return new N(1,0,0,0);let n=t.sum(e);n.len()<1e-9?n=n.orthogonal():n=n.normalize();let s=t.cross(n);return s.a=t.dot(n),s}unproject(e){return this.sum(e.smul(-this.dot(e)/(this.len()*e.len())))}rotatepoint(e){return e.mul(this).mul(e.invrot())}rotateface(e){return e.map(t=>t.rotatepoint(this))}intersect3(e,t){let n=this.det3x3(this.b,this.c,this.d,e.b,e.c,e.d,t.b,t.c,t.d);return Math.abs(n)<1e-9?!1:new N(0,this.det3x3(this.a,this.c,this.d,e.a,e.c,e.d,t.a,t.c,t.d)/n,this.det3x3(this.b,this.a,this.d,e.b,e.a,e.d,t.b,t.a,t.d)/n,this.det3x3(this.b,this.c,this.a,e.b,e.c,e.a,t.b,t.c,t.a)/n)}side(e){return e>1e-9?1:e<-1e-9?-1:0}cutface(e){let t=this.a,n=0,s=null;for(let i=0;i<e.length;i++)n|=1<<this.side(e[i].dot(this)-t)+1;if((n&5)===5){s=[];let i=e.map(r=>this.side(r.dot(this)-t));for(let r=-1;r<=1;r+=2){let o=[];for(let v=0;v<e.length;v++){(i[v]===r||i[v]===0)&&o.push(e[v]);let f=(v+1)%e.length;if(i[v]+i[f]===0&&i[v]!==0){let m=e[v].dot(this)-t,b=e[f].dot(this)-t,g=m/(m-b),u=e[v].smul(1-g).sum(e[f].smul(g));o.push(u)}}s.push(o)}}return s}cutfaces(e){let t=[];for(let n=0;n<e.length;n++){let s=e[n],i=this.cutface(s);i?(t.push(i[0]),t.push(i[1])):t.push(s)}return t}faceside(e){let t=this.a;for(let n=0;n<e.length;n++){let s=this.side(e[n].dot(this)-t);if(s!==0)return s}throw new Error("Could not determine side of plane in faceside")}sameplane(e){let t=this.normalize(),n=e.normalize();return t.dist(n)<1e-9||t.dist(n.smul(-1))<1e-9}makecut(e){return new N(e,this.b,this.c,this.d)}};var ke=1e-9;function st(){let c=Math.sqrt(.5);return[new N(c,c,0,0),new N(c,0,c,0)]}function it(){return[new N(.5,.5,.5,.5),new N(.5,.5,.5,-.5)]}function rt(){let c=2*Math.PI/10,e=.5+.3*Math.sqrt(5),t=.5+.1*Math.sqrt(5),n=Math.sqrt(e*e+t*t);return e/=n,t/=n,[new N(Math.cos(c),e*Math.sin(c),t*Math.sin(c),0),new N(.5,.5,.5,.5)]}function ot(){let c=.16666666666666666+Math.sqrt(5)/6,e=2/3+Math.sqrt(5)/3,t=Math.sqrt(c*c+e*e);c/=t,e/=t;let n=2*Math.PI/6;return[new N(Math.cos(n),c*Math.sin(n),e*Math.sin(n),0),new N(Math.cos(n),-c*Math.sin(n),e*Math.sin(n),0)]}function at(){let c=Math.sqrt(.5);return[new N(.5,.5,.5,.5),new N(c,0,0,c)]}function lt(c){let e=[new N(1,0,0,0)];for(let t=0;t<e.length;t++)for(let n=0;n<c.length;n++){let s=c[n].mul(e[t]),i=s.smul(-1),r=!1;for(let o=0;o<e.length;o++)if(s.dist(e[o])<ke||i.dist(e[o])<ke){r=!0;break}r||e.push(s)}return e}function $e(c,e){let t=[],n=[];for(let s=0;s<e.length;s++){let i=c.rotateplane(e[s]),r=!1;for(let o=0;o<t.length;o++)if(i.dist(t[o])<ke){r=!0;break}r||(t.push(i),n.push(e[s]))}return n}function Ge(c){let e=[];for(let t=1;t<c.length;t++)for(let n=t+1;n<c.length;n++){let s=nt(0,t,n,c);if(s){let i=!1;for(let r=0;r<e.length;r++)if(s.dist(e[r])<ke){i=!0;break}i||e.push(s)}}for(;;){let t=!1;for(let n=0;n<e.length;n++){let s=(n+1)%e.length;if(c[0].dot(e[n].cross(e[s]))<0){let i=e[n];e[n]=e[s],e[s]=i,t=!0}}if(!t)break}return e}var Ie=class{constructor(){this.mult=[]}multiply(e){for(let t=2;t*t<=e;t++)for(;e%t===0;)this.mult[t]!==void 0?this.mult[t]++:this.mult[t]=1,e/=t;e>1&&(this.mult[e]!==void 0?this.mult[e]++:this.mult[e]=1)}toString(){let e="";for(let t=0;t<this.mult.length;t++)this.mult[t]!==void 0&&(e!==""&&(e+="*"),e+=t,this.mult[t]>1&&(e+=`^${this.mult[t]}`));return e}};function Re(c,e){let t=c[0].p.length,n=_e(t),s=[],i=[],r=[],o=[],v=[];function f(u){for(let p=u.p.length-1;p>=0;p--){let a=u.p[p];if(a!==p){if(!s[p][a])return!1;u=u.mul(i[p][a])}}return!0}function m(u,p,a){o[u].push(p),v[u].push(a);for(let h=0;h<s[u].length;h++)s[u][h]&&b(u,s[u][h].mul(p),a+r[u][h])}function b(u,p,a){let h=p.p[u];if(!s[u][h]){s[u][h]=p,i[u][h]=p.inv(),r[u][h]=a;for(let M=0;M<o[u].length;M++)b(u,p.mul(o[u][M]),a+v[u][M]);return}let F=p.mul(i[u][h]);f(F)||m(u-1,F,a+r[u][h])}function g(){s=[],i=[],o=[],r=[],v=[];for(let a=0;a<t;a++)s.push([]),i.push([]),r.push([]),o.push([]),v.push([]),s[a][a]=n,i[a][a]=n,r[a][a]=0;let u=0,p=BigInt(1);for(let a=0;a<c.length;a++){m(t-1,c[a],1),p=BigInt(1);let h=0,F=0,M=[],y=new Ie;for(let D=0;D<t;D++){let P=0,T=0;for(let $=0;$<t;$++)s[D][$]&&(P++,T+=r[D][$],D!==$&&u++);h+=o[D].length,p*=BigInt(P),P>1&&y.multiply(P);let Z=T/P;M.push(Z),F+=Z}e(`${a}: sz ${p} T ${h} sol ${F} none ${u} mults ${y.toString()}`)}return p}return g()}var re=class{constructor(e){this.coords=new Array(e.length*3);for(let t=0;t<e.length;t++)this.coords[3*t]=e[t].b,this.coords[3*t+1]=e[t].c,this.coords[3*t+2]=e[t].d;this.length=e.length}get(e){return new N(0,this.coords[3*e],this.coords[3*e+1],this.coords[3*e+2])}centermass(){let e=0,t=0,n=0;for(let s=0;s<this.length;s++)e+=this.coords[3*s],t+=this.coords[3*s+1],n+=this.coords[3*s+2];return new N(0,e/this.length,t/this.length,n/this.length)}rotate(e){let t=[];for(let n=0;n<this.length;n++)t.push(this.get(n).rotatepoint(e));return new re(t)}rotateforward(){let e=[];for(let t=1;t<this.length;t++)e.push(this.get(t));return e.push(this.get(0)),new re(e)}},me=class{constructor(e,t,n){this.face=e;this.left=t;this.right=n}split(e){let t=e.cutface(this.face);return t!==null&&(this.left===void 0?(this.left=new me(t[0]),this.right=new me(t[1])):(this.left=this.left?.split(e),this.right=this.right?.split(e))),this}collect(e,t){return this.left===void 0?e.push(new re(this.face)):t?(this.left?.collect(e,!1),this.right?.collect(e,!0)):(this.right?.collect(e,!1),this.left?.collect(e,!0)),e}};function Dt(c,e){let t=[];for(let n of c)for(let s of e)t.push(s.rotate(n));return t}var A=1e-9,Bt="PuzzleGeometry 0.1 Copyright 2018 Tomas Rokicki.",Pt=!1;function Lt(){return{4:[["F","D","L","R"]],6:[["F","D","L","U","R"],["R","F","","B",""]],8:[["F","D","L","R"],["D","F","BR",""],["BR","D","","BB"],["BB","BR","U","BL"]],12:[["U","F","","","",""],["F","U","R","C","A","L"],["R","F","","","E",""],["E","R","","BF","",""],["BF","E","BR","BL","I","D"]],20:[["R","C","F","E"],["F","R","L","U"],["L","F","A",""],["E","R","G","I"],["I","E","S","H"],["S","I","J","B"],["B","S","K","D"],["K","B","M","O"],["O","K","P","N"],["P","O","Q",""]]}}function kt(){return{4:{F:"#00ff00",D:"#ffff00",L:"#ff0000",R:"#0000ff"},6:{U:"#ffffff",F:"#00ff00",R:"#ff0000",D:"#ffff00",B:"#0000ff",L:"#ff8000"},8:{U:"#ffffff",F:"#ff0000",R:"#00bb00",D:"#ffff00",BB:"#1122ff",L:"#9524c5",BL:"#ff8800",BR:"#aaaaaa"},12:{U:"#ffffff",F:"#006633",R:"#ff0000",C:"#ffffd0",A:"#3399ff",L:"#660099",E:"#ff66cc",BF:"#99ff00",BR:"#0000ff",BL:"#ffff00",I:"#ff6633",D:"#999999"},20:{R:"#db69f0",C:"#178fde",F:"#23238b",E:"#9cc726",L:"#2c212d",U:"#177fa7",A:"#e0de7f",G:"#2b57c0",I:"#41126b",S:"#4b8c28",H:"#7c098d",J:"#7fe7b4",B:"#85fb74",K:"#3f4bc3",D:"#0ff555",M:"#f1c2c8",O:"#58d340",P:"#c514f2",N:"#14494e",Q:"#8b1be1"}}}var Rt={4:{v:["DFR","DLF","DRL","FLR"],e:["FR","LF","DF","DL","RD","RL"],c:["DF","FD","RL","LR"]},6:{v:["URF","UBR","ULB","UFL","DFR","DRB","DBL","DLF"],e:["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],c:["UB","LU","FU","RU","BU","DF"]},8:{v:["UBBBRR","URFL","ULBLBB","DBRBBBL","DBLLF","DFRBR"],e:["UL","UBB","UR","BRD","BLD","FD","BRR","FR","FL","BLL","BLBB","BRBB"],c:["BBU","LU","RU","BRD","FD","BLD","DF","UBB"]},12:{v:["URF","UFL","ULBL","UBLBR","UBRR","DEBF","DBFI","DIA","DAC","DCE","LAI","ALF","FCA","CFR","REC","ERBR","BRBFE","BFBRBL","BLIBF","IBLL"],e:["UF","UR","UBR","UBL","UL","ER","EBR","EBF","ED","EC","IBF","IBL","IL","IA","ID","AC","CF","FA","BFBR","BRBL","BLBF","CD","AD","AL","FL","FR","CR","BFD","BRR","BLL"],c:["UF","FU","DBF","BFD","AD","CD","BRU","BLU","LA","RA","EBR","IBL"]},20:{v:["FLPQU","FUGER","FRCAL","HCREI","ISBDH","JSIEG","BSJMK","MQPOK","ONDBK","NOPLA","UQMJG","DNACH"],e:["FU","FL","FR","EG","ER","EI","SJ","SI","SB","KM","KB","KO","PQ","PO","PL","UG","JG","MQ","UQ","HC","HD","ND","NA","JM","CA","AL","CR","HI","DB","NO"],c:["FU","UF","GE","EG","JS","SJ","MK","KM","QP","PQ","LA","AL","RC","CR","IH","HI","BD","DB","ON","NO"]}};function Ot(){return{4:[["FLR",[0,1,0]],["F",[0,0,1]]],6:[["U",[0,1,0]],["F",[0,0,1]]],8:[["U",[0,1,0]],["F",[0,0,1]]],12:[["U",[0,1,0]],["F",[0,0,1]]],20:[["GUQMJ",[0,1,0]],["F",[0,0,1]]]}}function Oe(c,e){for(let t=0;t<c.length;t++)if(c[t][0].dist(e)<A)return t;throw new Error("Element not found")}function ct(){return Pe}function ut(c){return Pe[c]}var ft=["c","t","o","d","i"],ht=["f","v","e"];function ze(c){let e=c.split(/ /).filter(Boolean);if(e.length%2===0)return null;let t=e[0];if(t!=="o"&&t!=="c"&&t!=="i"&&t!=="d"&&t!=="t")return null;let n=[];for(let s=1;s<e.length;s+=2){if(e[s]!=="f"&&e[s]!=="v"&&e[s]!=="e")return null;n.push({cutType:e[s],distance:parseFloat(e[s+1])})}return{shape:t,cuts:n}}function Ke(c,e={}){let t=ze(c);if(t===null)throw new Error("Could not parse the puzzle description");let n=new xe(t,Object.assign({},{allMoves:!0},e));return n.allstickers(),n.genperms(),n}function pt(c,e){return Ke(Pe[c],e)}function Et(c,e,t){let n=!1;t-e[1]<e[0]&&(c=[c[2],c[3],c[0],c[1]],e=[t-e[1],t-e[0]],n=!0);let s=c[0],i="";if(e[0]===0&&e[1]===t)s=`${s}v`;else if(e[0]===e[1])e[1]>0&&(i=String(e[1]+1));else if(e[0]===0)s=s.toLowerCase(),e[1]>1&&(i=String(e[1]+1));else throw new Error(`We only support slice and outer block moves right now. ${e}`);return[i+s,n]}function Nt(c,e){let t=[],n=0;for(;n<c.length;){n>0&&n<c.length&&c[n]==="_"&&n++;let s="";for(let i of e)c.substr(n).startsWith(i[1])&&i[1].length>s.length&&(s=i[1]);if(s!=="")t.push(s),n+=s.length;else throw new Error(`Could not split ${c} into face names.`)}return t}function Ee(c,e){return[c.b/e,-c.c/e,c.d/e]}function Ae(c,e){let t=[],n=c.length;for(let s=0;s<n;s++){let i=Ee(c.get(n-s-1),e);t[3*s]=i[0],t[3*s+1]=i[1],t[3*s+2]=i[2]}return t}var xe=class{constructor(e,t){this.puzzleDescription=e;this.cmovesbyslice=[];this.duplicatedFaces=[];this.duplicatedCubies=[];this.fixedCubie=-1;this.net=[];this.colors=[];this.notationMapper=new ae;this.addNotationMapper="";this.setReidOrder=!1;let n="genperms";this.options=new Me(t),this.options.verbosity>0&&console.log(this.header("# ")),this.create(e)}create(e){let{shape:t,cuts:n}=e;this.moveplanes=[],this.moveplanes2=[],this.faces=[],this.cubies=[];let s=null;switch(t){case"c":{s=st();break}case"o":{s=at();break}case"i":{s=ot();break}case"t":{s=it();break}case"d":{s=rt();break}default:throw new Error(`Bad shape argument: ${t}`)}this.rotations=lt(s),this.options.verbosity&&console.log(`# Rotations: ${this.rotations.length}`);let i=s[0];this.baseplanerot=$e(i,this.rotations);let r=this.baseplanerot.map(l=>i.rotateplane(l));this.baseplanes=r,this.baseFaceCount=r.length;let o=Lt()[r.length];this.net=o,this.colors=kt()[r.length],this.options.verbosity>0&&console.log(`# Base planes: ${r.length}`);let v=Ge(r),f=new N(0,0,0,0);this.options.verbosity>0&&console.log(`# Face vertices: ${v.length}`);let m=r[0].makenormal(),b=v[0].sum(v[1]).makenormal(),g=v[0].makenormal(),u=new N(1,m.b,m.c,m.d);this.options.verbosity>0&&console.log(`# Boundary is ${u}`);let a=$e(u,this.rotations).map(l=>u.rotateplane(l)),h=Ge(a);this.edgedistance=h[0].sum(h[1]).smul(.5).dist(f),this.vertexdistance=h[0].dist(f);let F=[],M=[],y=!1,D=!1,P=!1;for(let l of n){let x=null,O=0;switch(l.cutType){case"f":{x=m,O=1,y=!0;break}case"v":{x=g,O=this.vertexdistance,P=!0;break}case"e":{x=b,O=this.edgedistance,D=!0;break}default:throw new Error(`Bad cut argument: ${l.cutType}`)}F.push(x.makecut(l.distance)),M.push(l.distance<O)}this.options.addRotations&&(y||F.push(m.makecut(10)),P||F.push(g.makecut(10)),D||F.push(b.makecut(10))),this.basefaces=[];for(let l of this.baseplanerot){let x=l.rotateface(h);this.basefaces.push(new re(x))}let T=[],Z=[],$=[],j=[],d=h.length;function L(l,x,O){for(let k of l)if(k[0].dist(x)<A){k.push(O);return}l.push([x,O])}for(let l=0;l<this.baseplanerot.length;l++){let x=this.baseplanerot[l].rotateface(h);for(let O=0;O<x.length;O++){let k=(O+1)%x.length,U=x[O].sum(x[k]).smul(.5);L(j,U,l)}}let E=[];for(let l=0;l<this.baseplanerot.length;l++){let x=this.baseplanerot[l].rotateface(h),O=[];for(let k=0;k<x.length;k++){let U=(k+1)%x.length,G=x[k].sum(x[U]).smul(.5),W=j[Oe(j,G)];if(l===W[1])O.push(W[2]);else if(l===W[2])O.push(W[1]);else throw new Error("Could not find edge")}E.push(O)}let w={},z=[];z.push(o[0][0]),w[o[0][0]]=0,z[E[0][0]]=o[0][1],w[o[0][1]]=E[0][0];for(let l of o){let x=l[0],O=w[x];if(O===void 0)throw new Error("Bad edge description; first edge not connected");let k=-1;for(let U=0;U<E[O].length;U++){let G=z[E[O][U]];if(G!==void 0&&G===l[1]){k=U;break}}if(k<0)throw new Error("First element of a net not known");for(let U=2;U<l.length;U++){if(l[U]==="")continue;let G=E[O][(U+k-1)%d],W=z[G];if(W!==void 0&&W!==l[U])throw new Error("Face mismatch in net");z[G]=l[U],w[l[U]]=G}}for(let l=0;l<this.baseplanerot.length;l++){let x=this.baseplanerot[l].rotateface(h),O=u.rotateplane(this.baseplanerot[l]),k=z[l];T.push([x,k]),Z.push([O,k])}for(let l=0;l<this.baseplanerot.length;l++){let x=this.baseplanerot[l].rotateface(h),O=z[l];for(let k=0;k<x.length;k++){let U=(k+1)%x.length,G=x[k].sum(x[U]).smul(.5),W=(k+2)%x.length,mt=x[U].sum(x[W]).smul(.5),bt=Oe(j,G),dt=Oe(j,mt);L($,x[U],[O,dt,bt])}}this.swizzler=new ue(T.map(l=>l[1]));let R=this.swizzler.prefixFree?"":"_",S=Rt[this.baseFaceCount],Q=[];for(let l=0;l<this.baseFaceCount;l++)Q[1<<l]=l;{let l=S.v;for(let x of l){let O=this.swizzler.splitByFaceNames(x),k=0;for(let U of O)k|=1<<U;Q[k]=O[0]}}{let l=S.e;for(let x of l){let O=this.swizzler.splitByFaceNames(x),k=0;for(let U of O)k|=1<<U;Q[k]=O[0]}}{let l=S.c;for(let x of l){let O=this.swizzler.splitByFaceNames(x),k=1<<O[0]|1<<this.baseFaceCount;Q[k]=O[1]}}for(let l=0;l<j.length;l++){if(j[l].length!==3)throw new Error(`Bad length in edge names ${j[l]}`);let x=j[l][1],O=j[l][2],k=z[x],U=z[O],G=1<<x|1<<O;Q[G]===x?k=k+R+U:k=U+R+k,j[l]=[j[l][0],k]}for(let l=0;l<$.length;l++){let x=0;if($[l].length<4)throw new Error("Bad length in vertex names");for(let G=1;G<$[l].length;G++)x|=1<<w[$[l][G][0]];let O=Q[x],k=-1;for(let G=1;G<$[l].length;G++)O===w[$[l][G][0]]&&(k=G);if(k<0)throw new Error("Internal error; couldn't find face name when fixing corners");let U="";for(let G=1;G<$[l].length;G++){G===1?U=$[l][k][0]:U=U+R+$[l][k][0];for(let W=1;W<$[l].length;W++)if($[l][k][1]===$[l][W][2]){k=W;break}}$[l]=[$[l][0],U]}this.markedface=Q,this.options.verbosity>1&&(console.log(`# Face names: ${T.map(l=>l[1]).join(" ")}`),console.log(`# Edge names: ${j.map(l=>l[1]).join(" ")}`),console.log(`# Vertex names: ${$.map(l=>l[1]).join(" ")}`));let I=[];for(let l of Z)I.push([l[0].makenormal(),l[1],"f"]);for(let l of j)I.push([l[0].makenormal(),l[1],"e"]);for(let l of $)I.push([l[0].makenormal(),l[1],"v"]);this.facenames=T,this.faceplanes=Z,this.edgenames=j,this.vertexnames=$,this.geonormals=I;let K=I.map(l=>l[1]);this.swizzler.setGripNames(K),this.options.verbosity>0&&console.log(`# Distances: face ${1} edge ${this.edgedistance} vertex ${this.vertexdistance}`);for(let l=0;l<F.length;l++)for(let x of this.rotations){let O=F[l].rotateplane(x),k=!1;for(let U of this.moveplanes)if(O.sameplane(U)){k=!0;break}k||(this.moveplanes.push(O),M[l]&&this.moveplanes2.push(O))}let Y=new me(h),V=this.moveplanes2.slice(),oe=31;for(let l=0;l<V.length;l++){let x=l+Math.floor((V.length-l)*(oe/65536));Y=Y.split(V[x]),V[x]=V[l],oe=(oe*1657+101)%65536}let J=Y.collect([],!0);this.faces=J,this.options.verbosity>0&&console.log(`# Faces is now ${J.length}`),this.stickersperface=J.length;let be=[],ne=Le(h);for(let l of this.rotations){let x=l.rotateface(h);ne.dist(Le(x))<A&&be.push(l)}let se=new Array(J.length),H=[];for(let l=0;l<J.length;l++){let x=J[l].centermass();H.push([ne.dist(x),x,l])}H.sort((l,x)=>l[0]-x[0]);for(let l=0;l<J.length;l++){let x=H[l][2];if(!se[x]){se[x]=!0;for(let O of be){let k=J[x].rotate(O),U=k.centermass();for(let G=l+1;G<J.length&&!(H[G][0]-H[l][0]>A);G++){let W=H[G][2];if(!se[W]&&U.dist(H[G][1])<A){se[W]=!0,J[W]=k;break}}}}}this.shortedge=1e99;for(let l of J)for(let x=0;x<l.length;x++){let O=(x+1)%l.length,k=l.get(x).dist(l.get(O));k<this.shortedge&&(this.shortedge=k)}this.options.verbosity>0&&console.log(`# Short edge is ${this.shortedge}`),t==="c"&&y&&!D&&!P&&(this.addNotationMapper="NxNxNCubeMapper",this.setReidOrder=!0),t==="c"&&P&&!y&&!D&&(this.addNotationMapper="SkewbMapper"),t==="t"&&(P||y)&&!D&&(this.addNotationMapper="PyraminxOrTetraminxMapper"),t==="o"&&y&&(this.notationMapper=new fe(this.swizzler,new ue(["F","D","L","BL","R","U","BR","B"])),D||P||(this.addNotationMapper="FTOMapper")),t==="d"&&y&&(this.addNotationMapper="MegaminxMapper",this.notationMapper=new fe(this.swizzler,new ue(["U","F","L","BL","BR","R","FR","FL","DL","B","DR","D"])))}keyface(e){return this.keyface2(e.centermass())}keyface2(e){let t="",n=String.fromCharCode;for(let s of this.moveplanesets)if(s.length>0){let i=e.dot(s[0]),r=0,o=1;for(;o*2<=s.length;)o*=2;for(;o>0;o>>=1)r+o<=s.length&&i>s[r+o-1].a&&(r+=o);if(r<47)t=t+n(33+r);else if(r<47+47*47)t=t+n(33+47+Math.floor(r/47)-1)+n(33+r%47);else if(r<47+47*47+47*47*47)t=t+n(33+47+Math.floor((r-47)/(47*47)-1))+n(33+47+Math.floor((r-47)/47)%47)+n(33+r%47);else throw Error("Too many slices for cubie encoding")}return t}keyface3(e){let t=e.centermass(),n=[];for(let s of this.moveplanesets)if(s.length>0){let i=t.dot(s[0]),r=0,o=1;for(;o*2<=s.length;)o*=2;for(;o>0;o>>=1)r+o<=s.length&&i>s[r+o-1].a&&(r+=o);n.push(r)}return n}findface(e){let t=this.keyface2(e),n=this.facelisthash.get(t);if(n.length===1)return n[0];for(let s=0;s+1<n.length;s++){let i=this.facelisthash.get(t)[s];if(Math.abs(e.dist(this.facecentermass[i]))<A)return i}return n[n.length-1]}project2d(e,t,n){let s=this.facenames[e][0],i=(t+1)%s.length,r=this.baseplanes[e],o=s[i].sub(s[t]),v=o.len();o=o.normalize();let f=o.cross(r).normalize(),m=n[1].sub(n[0]),b=m.len()/v;m=m.normalize();let g=m.b,u=m.c,p=o.smul(g).sub(f.smul(u)).smul(b),a=f.smul(g).sum(o.smul(u)).smul(b),h=new N(0,n[0].b-p.dot(s[t]),n[0].c-a.dot(s[t]),0);return[p,a,h]}allstickers(){let e="allstickers";this.faces=Dt(this.baseplanerot,this.faces),this.options.verbosity>0&&console.log(`# Total stickers is now ${this.faces.length}`),this.facecentermass=new Array(this.faces.length);for(let d=0;d<this.faces.length;d++)this.facecentermass[d]=this.faces[d].centermass();let t=[],n=[];for(let d of this.moveplanes){let L=d.makenormal(),E=!1;for(let w of n)L.sameplane(w.makenormal())&&(E=!0);E||(n.push(L),t.push([]))}for(let d of this.moveplanes2){let L=d.makenormal();for(let E=0;E<n.length;E++)if(L.sameplane(n[E])){t[E].push(d);break}}for(let d=0;d<t.length;d++){let L=t[d].map(w=>w.normalizeplane()),E=n[d];for(let w=0;w<L.length;w++)L[w].makenormal().dist(E)>A&&(L[w]=L[w].smul(-1));L.sort((w,z)=>w.a-z.a),t[d]=L}this.moveplanesets=t,this.moveplanenormals=n;let s=t.map(d=>d.length);this.options.verbosity>0&&console.log(`# Move plane sets: ${s}`);let i=[];for(let d=0;d<t.length;d++)i.push([]);for(let d of this.rotations){if(Math.abs(Math.abs(d.a)-1)<A)continue;let L=d.makenormal();for(let E=0;E<t.length;E++)if(L.sameplane(n[E])){i[E].push(d);break}}this.moverotations=i;for(let d=0;d<i.length;d++){let L=i[d],E=L[0].makenormal();for(let w=0;w<L.length;w++)E.dist(L[w].makenormal())>A&&(L[w]=L[w].smul(-1));L.sort((w,z)=>w.angle()-z.angle()),i[d][0].dot(n[d])<0&&L.reverse()}let r=i.map(d=>1+d.length);this.movesetorders=r;let o=[],v="?";for(let d=0;d<t.length;d++){let L=n[d],E=null,w=null;for(let z of this.geonormals){let R=L.dot(z[0]);Math.abs(R-1)<A?(w=[z[1],z[2]],v=z[2]):Math.abs(R+1)<A&&(E=[z[1],z[2]],v=z[2])}if(w===null||E===null)throw new Error("Saw positive or negative sides as null");o.push([w[0],w[1],E[0],E[1],1+t[d].length]),this.addNotationMapper==="NxNxNCubeMapper"&&v==="f"&&(this.notationMapper=new ve(1+t[d].length),this.addNotationMapper=""),this.addNotationMapper==="SkewbMapper"&&t[0].length===1&&(this.notationMapper=new ye(this.swizzler),this.addNotationMapper=""),this.addNotationMapper==="PyraminxOrTetraminxMapper"&&(t[0].length===2&&t[0][0].a===.333333333333333&&t[0][1].a===1.66666666666667?(this.notationMapper=new he(this.swizzler),this.addNotationMapper=""):(this.notationMapper=new we(this.swizzler),this.addNotationMapper="")),this.addNotationMapper==="MegaminxMapper"&&v==="f"&&(1+t[d].length===3&&(this.notationMapper=new ge(this.notationMapper)),this.addNotationMapper=""),this.addNotationMapper==="FTOMapper"&&v==="f"&&(1+t[d].length===3&&(this.notationMapper=new de(this.notationMapper,this.swizzler)),this.addNotationMapper="")}this.movesetgeos=o;let f=new Map,m=this.faces;for(let d=0;d<m.length;d++){let L=m[d],E=this.keyface(L);if(!f.get(E))f.set(E,[d]);else{let w=f.get(E);if(w.push(d),w.length===this.baseFaceCount){this.options.verbosity>0&&console.log("# Splitting core.");for(let z=0;z<w.length;z++){let R=`${E} ${z}`;f.set(R,[w[z]])}}}}this.facelisthash=f,this.options.verbosity>0&&console.log(`# Cubies: ${f.size}`);let b=[],g=[],u=[];for(let d of f.values())if(d.length!==this.baseFaceCount){if(d.length>1){let L=d.map(S=>m[S].centermass()),E=Le(L);for(let S=0;d.length>2;S++){let Q=!1;for(let I=0;I<d.length;I++){let K=(I+1)%d.length;if(E.dot(L[I].cross(L[K]))<0){let Y=L[I];L[I]=L[K],L[K]=Y;let V=d[I];d[I]=d[K],d[K]=V,Q=!0}}if(!Q)break;if(S>1e3)throw new Error("Bad epsilon math; too close to border")}let w=0;for(let S of d)w|=1<<Math.floor(S/this.stickersperface);let z=this.markedface[w],R=-1;for(let S=0;S<d.length;S++)Math.floor(d[S]/this.stickersperface)===z&&(R=S);if(R<0)throw new Error("Could not find marked face in list");if(R!==0){let S=d.slice();for(let Q=0;Q<d.length;Q++)d[Q]=S[(R+Q)%d.length]}}for(let L=0;L<d.length;L++){let E=d[L];g[E]=b.length,u[E]=L}b.push(d)}this.cubies=b,this.facetocubie=g,this.facetoord=u;let p=["?","CENTERS","EDGES","CORNERS","C4RNER","C5RNER"],a=[],h=[0,0,0,0,0,0],F=[],M=[],y=0,D=[],P=[],T=[],Z=[],$=d=>b[d].map(L=>this.getfaceindex(L)).join(" "),j=[];for(let d=0;d<b.length;d++){let L=b[d];if(L.length===0||M[d])continue;let E={},w=0;T.push(0),j.push([]);let z=L.length,R=h[z]++,S=p[z];(S===void 0||z===this.baseFaceCount)&&(S="CORE"),S=S+(R===0?"":R+1),a[y]=S,F[y]=z;let Q=[d],I=0;for(M[d]=!0;I<Q.length;){let K=Q[I++],Y=$(K);if((L.length>1||E[Y]===void 0)&&(E[Y]=w++),Z[K]=E[Y],D[K]=y,j[y].push(K),P[K]=T[y]++,Q.length<this.rotations.length){let V=this.facecentermass[b[K][0]];for(let oe of i){let J=this.facetocubie[this.findface(V.rotatepoint(oe[0]))];M[J]||(Q.push(J),M[J]=!0)}}}y++}if(this.setReidOrder&&4<=this.stickersperface&&this.stickersperface<=9){let d=[["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],["UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"],["U","L","F","R","B","D"]],L={};for(let E of d)for(let w=0;w<E.length;w++){let z=0;for(let R=0;R<E[w].length;R++)z|=1<<E[w].charCodeAt(R)-65;L[z]=w}for(let E of j)for(let w of E){let z=0;for(let R of b[w])z|=1<<this.facenames[this.getfaceindex(R)][1].charCodeAt(0)-65;P[w]=L[z]}}if(this.cubiesetnums=D,this.cubieordnums=P,this.cubiesetnames=a,this.cubieords=T,this.orbitoris=F,this.cubievaluemap=Z,this.cubiesetcubies=j,this.options.fixedPieceType!==null){for(let d=0;d<b.length;d++)if(this.options.fixedPieceType==="v"&&b[d].length>2||this.options.fixedPieceType==="e"&&b[d].length===2||this.options.fixedPieceType==="f"&&b[d].length===1){this.fixedCubie=d;break}if(this.fixedCubie<0)throw new Error(`Could not find a cubie of type ${this.options.fixedPieceType} to fix.`)}this.options.verbosity>0&&console.log(`# Cubie orbit sizes ${T}`)}unswizzle(e){let t=this.notationMapper.notationToInternal(e);return t===null?null:t.modified({family:this.swizzler.unswizzle(t.family)})}stringToBlockMove(e){let t=RegExp("^(([0-9]+)-)?([0-9]+)?([^0-9]+)([0-9]+'?)?$"),n=e.match(t);if(n===null)throw new Error(`Bad move passed ${e}`);let s=n[4],i,r;if(n[2]!==void 0){if(n[3]===void 0)throw new Error("Missing second number in range");i=parseInt(n[2],10)}n[3]!==void 0&&(r=parseInt(n[3],10));let o="1",v=1;return n[5]!==void 0&&(o=n[5],o[0]==="'"&&(o=`-${o.substring(1)}`),v=parseInt(o,10)),new B(new C(s,r,i),v)}parseMove(e){let t=this.notationMapper.notationToInternal(e);if(t===null)throw new Error(`Bad move ${e.family}`);e=t;let n=e.family,s=!1;if(n.endsWith("v")&&n[0]<="Z"){if(e.innerLayer!==void 0||e.outerLayer!==void 0)throw new Error("Cannot use a prefix with full cube rotations");n=n.slice(0,-1),s=!0}n.endsWith("w")&&n[0]<="Z"&&(n=n.slice(0,-1).toLowerCase());let i,r=-1,o=this.swizzler.unswizzle(n),v=!1;for(let b=0;b<this.movesetgeos.length;b++){let g=this.movesetgeos[b];o===g[0]&&(v=!0,i=g,r=b),o===g[2]&&(v=!1,i=g,r=b)}let f=1,m=1;if(n.toUpperCase()!==n&&(m=2),i===void 0)throw new Error(`Bad grip in move ${e.family}`);if(e.outerLayer!==void 0&&(f=e.outerLayer),e.innerLayer!==void 0&&(e.outerLayer===void 0?(m=e.innerLayer,n<="Z"?f=m:f=1):m=e.innerLayer),f--,m--,s&&(f=0,m=this.moveplanesets[r].length),f<0||f>this.moveplanesets[r].length||m<0||m>this.moveplanesets[r].length)throw new Error(`Bad slice spec ${f} ${m} vs ${this.moveplanesets[r].length}`);if(!Pt&&f===0&&m===this.moveplanesets[r].length&&!s)throw new Error("! full puzzle rotations must be specified with v suffix.");return[void 0,r,f,m,v,e.amount]}parsemove(e){let t=this.parseMove(this.stringToBlockMove(e));return t[0]=e,t}genperms(){let e="genperms";if(this.cmovesbyslice.length>0)return;let t=[];if(this.options.orientCenters){for(let n=0;n<this.cubies.length;n++)if(this.cubies[n].length===1){let s=this.cubies[n][0],i=this.getfaceindex(s),r=this.basefaces[i].centermass();if(r.dist(this.facecentermass[s])<A){let o=1<<i|1<<this.baseFaceCount,v=this.markedface[o],f=this.baseplanes[v].makenormal(),m=-1,b=-1;for(let p=0;p<this.faces[s].length;p++){let a=this.faces[s].get(p),h=f.dot(a.sub(r));h>m&&(m=h,b=p)}let g=(b+1)%this.faces[s].length;if(Math.abs(f.dot(this.faces[s].get(g).sub(r))-m)<A&&(b=g),b!==0){let p=[];for(let a=0;a<this.faces[s].length;a++)p.push(this.faces[s].get((a+b)%this.faces[s].length));this.faces[s]=new re(p)}let u=this.basefaces[i].length;for(let p=1;p<u;p++)this.cubies[n].push(this.cubies[n][p-1]);this.duplicatedFaces[s]=u,this.duplicatedCubies[n]=u,this.orbitoris[this.cubiesetnums[n]]=u}}}for(let n=0;n<this.moveplanesets.length;n++){let s=this.moveplanesets[n],i=[],r=[s.length+1,0],o=1;for(;o*2<=s.length;)o*=2;for(let m=0;m<this.faces.length;m++){let b=0;if(s.length>0){let g=this.facecentermass[m].dot(s[0]);for(let u=o;u>0;u>>=1)b+u<=s.length&&g>s[b+u-1].a&&(b+=u);b=s.length-b}for(i.push(b);r.length<=b;)r.push(0);r[b]++}let v=new Array(r.length);for(let m=0;m<r.length;m++)v[m]=[];let f=[];for(let m=0;m<this.faces.length;m++){if(i[m]<0)continue;let b=[this.facetocubie[m],this.facetoord[m]],g=this.facecentermass[m],u=g,p=m,a=i[p];for(;;){i[p]=-1;let h=g.rotatepoint(this.moverotations[n][0]);if(h.dist(u)<A)break;p=this.findface(h),b.push(this.facetocubie[p],this.facetoord[p]),g=h}if(b.length>2&&this.options.orientCenters&&(this.cubies[b[0]].length===1||this.duplicatedCubies[b[0]]>1)&&this.facecentermass[m].dist(this.basefaces[this.getfaceindex(m)].centermass())<A){let h=this.faces[this.cubies[b[0]][0]];for(let F=0;F<b.length;F+=2){let M=this.faces[this.cubies[b[F]][0]],y=-1;for(let D=0;D<h.length;D++)if(M.get(D).dist(h.get(0))<A){y=D;break}if(y<0)throw new Error("Couldn't find rotation of center faces; ignoring for now.");b[F+1]=y,h=h.rotate(this.moverotations[n][0])}}if(b.length===2&&this.options.orientCenters)for(let h=1;h<this.movesetorders[n];h++)a===0?b.push(b[0],h):b.push(b[0],(this.movesetorders[n]-h)%this.movesetorders[n]);if(b.length>2&&!f[b[0]]){if(b.length!==2*this.movesetorders[n])throw new Error("Bad length in perm gen");for(let h of b)v[a].push(h)}for(let h=0;h<b.length;h+=2)f[b[h]]=!0}for(let m=0;m<v.length;m++)v[m]=v[m].slice();t.push(v)}if(this.cmovesbyslice=t,this.options.moveList){let n=[];for(let s of this.options.moveList)n.push(this.parsemove(s));this.parsedmovelist=n}this.facelisthash.clear(),this.facecentermass=[]}getboundarygeometry(){return{baseplanes:this.baseplanes,facenames:this.facenames,faceplanes:this.faceplanes,vertexnames:this.vertexnames,edgenames:this.edgenames,geonormals:this.geonormals}}getmovesets(e){let t=this.moveplanesets[e].length,n=[];if(this.parsedmovelist!==void 0)for(let s of this.parsedmovelist)s[1]===e&&(s[4]?n.push([s[2],s[3]]):n.push([t-s[3],t-s[2]]),n.push(s[5]));else if(this.options.vertexMoves&&!this.options.allMoves){let s=this.movesetgeos[e];if(s[1]!==s[3])for(let i=0;i<t;i++)s[1]!=="v"?(this.options.outerBlockMoves?n.push([i+1,t]):n.push([i+1]),n.push(1)):(this.options.outerBlockMoves?n.push([0,i]):n.push([i,i]),n.push(1))}else for(let s=0;s<=t;s++)!this.options.allMoves&&s+s===t||(this.options.outerBlockMoves?s+s>t?n.push([s,t]):n.push([0,s]):n.push([s,s]),n.push(1));if(this.fixedCubie>=0){let s=this.keyface3(this.faces[this.cubies[this.fixedCubie][0]])[e],i=[];for(let r=0;r<n.length;r+=2){let o=n[r];if(s>=o[0]&&s<=o[1])if(o[0]===0)o=[o[1]+1,t];else if(t===o[1])o=[0,o[0]-1];else throw Error("fixed cubie option would disconnect move");let v=!1;for(let f=0;f<i.length;f+=2)if(i[f][0]===o[0]&&i[f][1]===o[1]&&i[f+1]===n[r+1]){v=!0;break}v||(i.push(o),i.push(n[r+1]))}n=i}return n}graybyori(e){let t=this.cubies[e].length;return this.duplicatedCubies[e]&&(t=1),t===1&&(this.options.grayCenters||!this.options.includeCenterOrbits)||t===2&&(this.options.grayEdges||!this.options.includeEdgeOrbits)||t>2&&(this.options.grayCorners||!this.options.includeCornerOrbits)}skipbyori(e){let t=this.cubies[e].length;return this.duplicatedCubies[e]&&(t=1),t===1&&!this.options.includeCenterOrbits||t===2&&!this.options.includeEdgeOrbits||t>2&&!this.options.includeCornerOrbits}skipcubie(e){return this.skipbyori(e)}header(e){return e+Bt+`
`+e+`
`}writegap(){let e=this.getOrbitsDef(!1),t=[],n=[];for(let i=0;i<e.moveops.length;i++){let r=`M_${Fe(this.notationMapper,e.movenames[i])}`,o=!1;r[r.length-1]==="'"&&(r=r.substring(0,r.length-1),o=!0),n.push(r),o?t.push(`${r}:=${e.moveops[i].toPerm().inv().toGap()};`):t.push(`${r}:=${e.moveops[i].toPerm().toGap()};`)}t.push("Gen:=["),t.push(n.join(",")),t.push("];");let s=e.solved.identicalPieces();return t.push(`ip:=[${s.map(i=>`[${i.map(r=>r+1).join(",")}]`).join(",")}];`),t.push("# Size(Group(Gen));"),t.push("# Size(Stabilizer(Group(Gen), ip, OnTuplesSets));"),t.push(""),this.header("# ")+t.join(`
`)}writeksolve(e="PuzzleGeometryPuzzle"){let t=this.getOrbitsDef(!1);return this.header("# ")+t.toKsolve(e,this.notationMapper).join(`
`)}getKPuzzleDefinition(e=!0,t=!0){let s=this.getOrbitsDef(e,t).toKPuzzleDefinition(t);if(s.experimentalPuzzleDescription=this.puzzleDescription,!s)throw new Error("Missing definition!");return s}getMoveFromBits(e,t,n,s,i,r){let o=[],v=[],f=[];for(let g of this.cubieords)v.push(_(g)),f.push(ie(g));for(let g=e[0];g<=e[1];g++){let u=s[g];for(let p=0;p<u.length;p+=2*r){let a=u.slice(p,p+2*r),h=this.cubiesetnums[a[0]];for(let y=0;y<a.length;y+=2)a[y]=this.cubieordnums[a[y]];let F=2,M=3;n&&(F=a.length-2,M=a.length-1),v[h]===_(this.cubieords[h])&&(v[h]=v[h].slice(),this.orbitoris[h]>1&&!this.options.fixedOrientation&&(f[h]=f[h].slice()));for(let y=0;y<a.length;y+=2)v[h][a[(y+F)%a.length]]=a[y],this.orbitoris[h]>1&&!this.options.fixedOrientation&&(f[h][a[y]]=(a[(y+M)%a.length]-a[(y+1)%a.length]+2*this.orbitoris[h])%this.orbitoris[h])}}let m=new ee(_(24),ie(24),1);for(let g=0;g<this.cubiesetnames.length;g++)if(!(i&&!i[g]))if(this.orbitoris[g]===1||this.options.fixedOrientation)v[g]===_(m.perm.length)?(v[g]!==m.perm&&(m=new ee(v[g],f[g],1)),o.push(m)):o.push(new ee(v[g],f[g],1));else{let u=new Array(f[g].length);for(let p=0;p<v[g].length;p++)u[p]=f[g][v[g][p]];o.push(new ee(v[g],u,this.orbitoris[g]))}let b=new te(o);return t!==1&&(b=b.mulScalar(t)),b}omitSet(e){for(let t of this.options.excludeOrbits)if(t===e)return!0;return!1}diffmvsets(e,t,n,s){for(let i=0;i<e.length;i+=2){let r=!1;for(let o=0;!r&&o<t.length;o+=2)s?e[i][0]+t[o][1]===n&&e[i][1]+t[o][0]===n&&e[i+1]===t[o+1]&&(r=!0):e[i][0]===t[o][0]&&e[i][1]===t[o][1]&&e[i+1]===t[o+1]&&(r=!0);if(!r)return!0}return!1}getOrbitsDef(e,t=!0){let n=[];if(e)for(let a=0;a<this.cubiesetnames.length;a++)n.push(1);let s=[],i=[],r=[],o=[];for(let a=0;a<this.moveplanesets.length;a++){let h=this.getmovesets(a);r.push(h),this.options.addRotations?o.push(1):o.push(0)}let v=[];for(let a=0;a<this.moveplanesets.length;a++){let h=this.moveplanesets[a].length,F=!1,M=r[a];for(let y=0;y<M.length;y+=2)M[y][0]===0&&M[y][1]===h&&(F=!0);v[a]=F}if(this.options.addRotations&&(this.options.moveList||this.options.fixedPieceType!==null)){for(let a=0;a<this.moverotations.length;a++)o[a]=0;for(let a=0;a<this.moveplanesets.length;a++){if(v[a]){o[a]=3;continue}for(let h=0;h<this.moverotations.length;h++){let F=this.moveplanenormals[a];for(let M=1;M*2<=this.movesetorders[h];M++){if(F=F.rotatepoint(this.moverotations[h][0]),o[h]&M)continue;let y=-1,D=!1;for(let T=0;T<this.moveplanenormals.length;T++)if(F.dist(this.moveplanenormals[T])<A){y=T;break}else if(F.dist(this.moveplanenormals[T].smul(-1))<A){y=T,D=!0;break}if(y<0)throw new Error("Could not find rotation");let P=r[y];(P.length!==r[a].length||this.moveplanesets[a].length!==this.moveplanesets[y].length||this.diffmvsets(P,r[a],this.moveplanesets[y].length,D))&&(o[h]|=M)}}}for(let a=0;a<this.moverotations.length;a++)if(o[a]===0)o[a]=1;else if(o[a]===1)this.movesetorders[a]>3?o[a]=2:o[a]=0;else if(o[a]===3)o[a]=0;else throw new Error("Impossible addrot val")}for(let a=0;a<this.moveplanesets.length;a++)o[a]!==0&&!v[a]&&(r[a].push([0,this.moveplanesets[a].length]),r[a].push(o[a]));for(let a=0;a<this.moveplanesets.length;a++){let h=r[a],F=this.movesetorders[a];for(let D=0;D<h.length;D+=2)for(let P=0;P<D;P+=2)if(h[D][0]===h[P][0]&&h[D][1]===h[P][1])throw new Error("Redundant moves in moveset.");let M=[];for(let D=0;D<h.length;D+=2)for(let P=h[D][0];P<=h[D][1];P++)M[P]=1;let y=this.cmovesbyslice[a];for(let D=0;D<y.length;D++){if(M[D]!==1)continue;let P=y[D];for(let T=0;T<P.length;T+=2*F){if(this.skipcubie(P[T]))continue;let Z=this.cubiesetnums[P[T]];n[Z]=1}}}for(let a=0;a<this.cubiesetnames.length;a++)if(!!n[a]){if(this.omitSet(this.cubiesetnames[a])){n[a]=0;continue}s.push(this.cubiesetnames[a]),i.push(new pe(this.cubieords[a],this.options.fixedOrientation?1:this.orbitoris[a]))}let f=[];for(let a=0;a<this.cubiesetnames.length;a++){if(!n[a]||this.omitSet(this.cubiesetnames[a]))continue;let h=[],F=[];for(let M=0;M<this.cubieords[a];M++){if(e)h.push(M);else{let y=this.cubiesetcubies[a][M];h.push(this.cubievaluemap[y])}F.push(0)}f.push(new ee(h,F,this.options.fixedOrientation?1:this.orbitoris[a]))}let m=[],b=[],g=[],u=[];if(t)for(let a=0;a<this.moveplanesets.length;a++){let F=this.moveplanesets[a].length,M=r[a],y=this.movesetgeos[a];for(let D=0;D<M.length;D+=2){let P=M[D],T,Z=!1;if(this.parsedmovelist!==void 0)for(let j of this.parsedmovelist){if(j[1]!==a)continue;let d=[];j[4]?d=[j[2],j[3]]:d=[F-j[3],F-j[2]],d[0]===P[0]&&d[1]===P[1]&&(T=j[0],Z=!j[4])}if(T)m.push(T),b.push(!0);else{let j=Et(y,P,F);Z=j[1];let d=j[0];M[D+1]===1?m.push(d):m.push(d+M[D+1]),b.push(!1)}u.push(P[0]===0&&P[1]===F);let $=this.getMoveFromBits(P,M[D+1],Z,this.cmovesbyslice[a],n,this.movesetorders[a]);g.push($)}}let p=new le(s,i,new ce(f),m,g,u,b);return this.options.optimizeOrbits&&(p=p.optimize()),this.options.scrambleAmount!==0&&p.scramble(this.options.scrambleAmount),p}getScramble(e=0){let t=this.getOrbitsDef(!1);return t.transformToKTransformationData(t.getScrambleTransformation(e))}getMovesAsPerms(){return this.getOrbitsDef(!1).moveops.map(e=>e.toPerm())}showcanon(e){tt(this.getOrbitsDef(!1),e)}getsolved(){let e=[];for(let t=0;t<this.baseFaceCount;t++)for(let n=0;n<this.stickersperface;n++)e.push(t);return new X(e)}getOrientationRotation(e){let[t,[n,s,i]]=e[0],r=new N(0,n,-s,i),[o,[v,f,m]]=e[1],b=new N(0,v,-f,m),g=null,u=null,p=this.swizzler.unswizzle(t),a=this.swizzler.unswizzle(o);for(let y of this.geonormals)p===y[1]&&(g=y[0]),a===y[1]&&(u=y[0]);if(!g)throw new Error(`Could not find feature ${t}`);if(!u)throw new Error(`Could not find feature ${o}`);let h=g.pointrotation(r);return u.rotatepoint(h).unproject(r).pointrotation(b.unproject(r)).mul(h)}getInitial3DRotation(){let e=this.baseFaceCount,t=null;if(this.options.puzzleOrientation?t=this.options.puzzleOrientation:this.options.puzzleOrientations&&(t=this.options.puzzleOrientations[e]),t||(t=Ot()[e]),!t)throw new Error("No default orientation?");return this.getOrientationRotation(t)}generate2dmapping(e=800,t=500,n=10,s=!1,i=.92){e-=2*n,t-=2*n;function r(w,z){let R=w[1][0]-w[0][0],S=w[1][1]-w[0][1],Q=2*Math.PI/z,I=Math.cos(Q),K=Math.sin(Q);for(let Y=2;Y<z;Y++){let V=R*I+S*K;S=S*I-R*K,R=V,w.push([w[Y-1][0]+R,w[Y-1][1]+S])}}this.genperms();let f=this.getboundarygeometry().facenames[0][0].length,m=this.net;if(m===null)throw new Error("No net?");let b={},g=0,u=0,p=1,a=0;b[m[0][0]]=[[1,0],[0,0]],r(b[m[0][0]],f);for(let w of m){let z=w[0];if(!b[z])throw new Error("Bad edge description; first edge not connected.");for(let R=1;R<w.length;R++){let S=w[R];S===""||b[S]||(b[S]=[b[z][R%f],b[z][(R+f-1)%f]],r(b[S],f))}}for(let w in b){let z=b[w];for(let R of z)g=Math.min(g,R[0]),p=Math.max(p,R[0]),u=Math.min(u,R[1]),a=Math.max(a,R[1])}let h=Math.min(e/(p-g),t/(a-u)),F=.5*(e-h*(p+g)),M=.5*(t-h*(a+u)),y={},D=this.getboundarygeometry(),P={},T=[[h+F,M],[F,M]];P[m[0][0]]=T,r(P[m[0][0]],f),y[this.facenames[0][1]]=this.project2d(0,0,[new N(0,T[0][0],T[0][1],0),new N(0,T[1][0],T[1][1],0)]);let Z=[];Z[0]=0;for(let w of m){let z=w[0];if(!P[z])throw new Error("Bad edge description; first edge not connected.");let R=-1;for(let Q=0;Q<D.facenames.length;Q++)if(z===D.facenames[Q][1]){R=Q;break}if(R<0)throw new Error(`Could not find first face name ${z}`);let S=D.facenames[R][0];for(let Q=1;Q<w.length;Q++){let I=w[Q];if(I===""||P[I])continue;P[I]=[P[z][Q%f],P[z][(Q+f-1)%f]],r(P[I],f);let K=Z[R],Y=S[(K+Q)%f].sum(S[(K+Q+f-1)%f]).smul(.5),V=Oe(D.edgenames,Y),oe=D.edgenames[V][1],J=Nt(oe,this.facenames),be=J[z===J[0]?1:0],ne=-1;for(let H=0;H<D.facenames.length;H++)if(be===D.facenames[H][1]){ne=H;break}if(ne<0)throw new Error("Could not find second face name");let se=D.facenames[ne][0];for(let H=0;H<se.length;H++)if(se[H].sum(se[(H+1)%f]).smul(.5).dist(Y)<=A){let x=P[z][(Q+f-1)%f],O=P[z][Q%f];Z[ne]=H,y[be]=this.project2d(ne,H,[new N(0,O[0],O[1],0),new N(0,x[0],x[1],0)]);break}}}let $=0,j=0,d=this.getInitial3DRotation();for(let w of this.faces){s&&(w=w.rotate(d));for(let z=0;z<w.length;z++)$=Math.max($,Math.abs(w.get(z).b)),j=Math.max(j,Math.abs(w.get(z).c))}let L=Math.min(t/j/2,(e-n)/$/4);return(w,z)=>{if(s){z=z.rotatepoint(d);let R=.5*n+.25*e,S=this.baseplanes[w].rotateplane(d).d<0?1:-1;return[n+e*.5+S*(R-z.b*L),n+t*.5+z.c*L]}else{let R=y[this.facenames[w][1]];return[n+i*z.dot(R[0])+R[2].b,n+t-i*z.dot(R[1])-R[2].c]}}}generatesvg(e=800,t=500,n=10,s=!1){let i=this.generate2dmapping(e,t,n,s);function r(g,u,p){return`<polygon id="${g}" class="sticker" style="fill: ${p}" points="${u.map(a=>`${a[0]} ${a[1]}`).join(" ")}"/>
`}let o=this.getsolved(),v=[],f=[];for(let g=0;g<this.baseFaceCount;g++)v[g]=this.colors[this.facenames[g][1]];for(let g=0;g<this.faces.length;g++){let u=this.faces[g],p=Math.floor(g/this.stickersperface),a=[];for(let h=0;h<u.length;h++)a.push(i(p,u.get(h)));f.push(a)}let m=[];for(let g=0;g<this.baseFaceCount;g++){m.push("<g>"),m.push(`<title>${this.facenames[g][1]}</title>
`);for(let u=0;u<this.stickersperface;u++){let p=g*this.stickersperface+u,a=this.facetocubie[p],h=this.facetoord[p],F=this.cubiesetnums[a],M=this.cubieordnums[a],y=this.graybyori(a)?"#808080":v[o.p[p]],D=`${this.cubiesetnames[F]}-l${M}-o${h}`;if(m.push(r(D,f[p],y)),this.duplicatedFaces[p])for(let P=1;P<this.duplicatedFaces[p];P++)D=`${this.cubiesetnames[F]}-l${M}-o${P}`,m.push(r(D,f[p],y))}m.push("</g>")}return`<svg id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 800 500">
<style type="text/css"><![CDATA[.sticker { stroke: #000000; stroke-width: 1px; }]]></style>
${m.join("")}</svg>`}get3d(e){let t=[],n=this.getInitial3DRotation(),s=[],i=.52*this.basefaces[0].get(0).len();for(let f=0;f<this.basefaces.length;f++){let m=this.basefaces[f].rotate(n),b=this.facenames[f][1];s.push({coords:Ae(m,i),name:b})}for(let f=0;f<this.faces.length;f++){let m=Math.floor(f/this.stickersperface),b=this.facetocubie[f],g=this.facetoord[f],u=this.cubiesetnums[b],p=this.cubieordnums[b],a=this.graybyori(b)?"#808080":this.colors[this.facenames[m][1]];e?.stickerColors&&(a=e.stickerColors[f]);let h=this.faces[f].rotate(n);t.push({coords:Ae(h,i),color:a,orbit:this.cubiesetnames[u],ord:p,ori:g,face:m});let F=h;if(this.duplicatedFaces[f]){let M=F.length/this.duplicatedFaces[f];for(let y=1;y<this.duplicatedFaces[f];y++){for(let D=0;D<M;D++)F=F.rotateforward();t.push({coords:Ae(F,i),color:a,orbit:this.cubiesetnames[u],ord:p,ori:y,face:m,isDup:!0})}}}let r=[];for(let f=0;f<this.movesetgeos.length;f++){let m=this.movesetgeos[f],b=this.movesetorders[f];for(let g of this.geonormals)m[0]===g[1]&&m[1]===g[2]&&(r.push({coordinates:Ee(g[0].rotatepoint(n),1),quantumMove:new B(m[0]),order:b}),r.push({coordinates:Ee(g[0].rotatepoint(n).smul(-1),1),quantumMove:new B(m[2]),order:b}))}let o=this.generate2dmapping(2880,2160,0,!1,1),v=function(){let f=n.invrot();return function(m,b){let g=new N(0,b[0]*i,-b[1]*i,b[2]*i);g=g.rotatepoint(f);let u=o(m,g);return u[0]/=2880,u[1]=1-u[1]/2160,u}}().bind(this);return{stickers:t,faces:s,axis:r,unswizzle:this.unswizzle.bind(this),notationMapper:this.notationMapper,textureMapper:{getuv:v}}}getGeoNormal(e){let t=this.getInitial3DRotation(),n=this.swizzler.unswizzle(e);for(let s of this.geonormals)if(n===s[1]){let i=Ee(s[0].rotatepoint(t),1);return Math.abs(i[0])<A&&Math.abs(i[2])<A&&(i[0]=0,i[2]=1e-6),i}}getfaceindex(e){let t=this.stickersperface;return Math.floor(e/t)}textForTwizzleExplorer(){return`Faces ${this.baseplanerot.length}
Stickers per face ${this.stickersperface}
Short edge ${this.shortedge}
Cubies ${this.cubies.length}
Edge distance ${this.edgedistance}
Vertex distance ${this.vertexdistance}`}writeSchreierSims(e){let n=this.getOrbitsDef(!1).reassemblySize();e(`Reassembly size is ${n}`);let s=Re(this.getMovesAsPerms(),e),i=n/s;e(`Ratio is ${i}`)}},Ne=class{constructor(e,t){this.pg=e;this.orbitNames=t.orbitnames}lookupMove(e){let t=this.pg.parseMove(e);if(this.pg.parsedmovelist){let r=!1;for(let o of this.pg.parsedmovelist)o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]&&o[4]===t[4]&&(r=!0);if(!r)return null}let n=[t[2],t[3]];if(!t[4]){let r=this.pg.moveplanesets[t[1]].length;n=[r-t[3],r-t[2]]}let s=this.pg.getMoveFromBits(n,t[5],!t[4],this.pg.cmovesbyslice[t[1]],void 0,this.pg.movesetorders[t[1]]);return le.transformToKTransformationData(this.orbitNames,s)}};export{qe as a,N as b,Re as c,ct as d,ut as e,ft as f,ht as g,ze as h,Ke as i,pt as j,xe as k,Ne as l,Ct as m};
//# sourceMappingURL=chunk-XTKJBT3F.js.map
