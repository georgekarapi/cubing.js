{
  "version": 3,
  "sources": ["../../../../src/cubing/stream/twizzle/TwizzleStream.ts"],
  "sourcesContent": ["import { Move, QuantumMove } from \"../../alg\";\nimport type { StreamMessageEvent } from \"./stream-types\";\n\nclass TwizzleStream extends EventTarget {\n  socket: WebSocket;\n  constructor(url: string) {\n    super();\n    this.socket = new WebSocket(url);\n    this.socket.onmessage = this.onMessage.bind(this); // TODO: Can we \"add a listener instead\"?\n  }\n\n  onMessage(msg: MessageEvent): void {\n    try {\n      const json: StreamMessageEvent = JSON.parse(msg.data);\n      if (json.event === \"move\") {\n        const move = json.data.latestMove;\n        if (move.type !== \"blockMove\") {\n          throw new Error(\"Invalid move!\");\n        }\n        this.dispatchEvent(\n          new CustomEvent(\"move\", {\n            detail: {\n              move: new Move(new QuantumMove(move.family), move.amount),\n            },\n          }),\n        );\n      }\n    } catch (e) {\n      console.error(\"Could not handle message:\", e);\n    }\n  }\n}\n\ntype StreamsField = {\n  streamID: string;\n  senders: { name: string; twizzleUserID: string; wcaID: string | null }[];\n}[];\n\nexport class TwizzleStreamServer {\n  async streams(): Promise<StreamsField> {\n    return (\n      (await (await fetch(\"https://api.twizzle.net/v0/streams\")).json()) as {\n        streams: StreamsField;\n      }\n    ).streams;\n  }\n\n  connect(streamID: string): TwizzleStream {\n    return new TwizzleStream(\n      `wss://api.twizzle.net/v0/streams/${streamID}/socket`,\n    );\n  }\n}\n"],
  "mappings": "+CAGA,IAAMA,EAAN,cAA4B,WAAY,CAEtC,YAAYC,EAAa,CACvB,MAAM,EACN,KAAK,OAAS,IAAI,UAAUA,CAAG,EAC/B,KAAK,OAAO,UAAY,KAAK,UAAU,KAAK,IAAI,CAClD,CAEA,UAAUC,EAAyB,CACjC,GAAI,CACF,IAAMC,EAA2B,KAAK,MAAMD,EAAI,IAAI,EACpD,GAAIC,EAAK,QAAU,OAAQ,CACzB,IAAMC,EAAOD,EAAK,KAAK,WACvB,GAAIC,EAAK,OAAS,YAChB,MAAM,IAAI,MAAM,eAAe,EAEjC,KAAK,cACH,IAAI,YAAY,OAAQ,CACtB,OAAQ,CACN,KAAM,IAAIC,EAAK,IAAIC,EAAYF,EAAK,MAAM,EAAGA,EAAK,MAAM,CAC1D,CACF,CAAC,CACH,CACF,CACF,OAAS,EAAP,CACA,QAAQ,MAAM,4BAA6B,CAAC,CAC9C,CACF,CACF,EAOaG,EAAN,KAA0B,CAC/B,MAAM,SAAiC,CACrC,OACG,MAAO,MAAM,MAAM,oCAAoC,GAAG,KAAK,GAGhE,OACJ,CAEA,QAAQC,EAAiC,CACvC,OAAO,IAAIR,EACT,oCAAoCQ,UACtC,CACF,CACF",
  "names": ["TwizzleStream", "url", "msg", "json", "move", "Move", "QuantumMove", "TwizzleStreamServer", "streamID"]
}
